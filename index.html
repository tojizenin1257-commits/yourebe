<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOUREBE - YOUTURE | Plateforme Vidéo Française Gratuite</title>
    <meta name="keywords" content="youture, yourebe, plateforme vidéo, vidéo française, streaming gratuit, regarder vidéos, télécharger vidéos, youtube alternative">
    <meta name="description" content="YOUTURE (YOUREBE) - La plateforme vidéo française gratuite pour regarder, partager et télécharger des vidéos. Alternative à YouTube, streaming gratuit, sans publicité intrusive.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Import Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', Arial, sans-serif;
        }

        body {
            background-color: #0f0f0f;
            color: #f1f1f1;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background-color: #0f0f0f;
            padding: 12px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid #3f3f3f;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 12px;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #ff0000;
            cursor: pointer;
        }

        .logo i {
            margin-right: 8px;
            font-size: 24px;
        }

        .sidebar-section {
            padding: 8px 0;
            border-bottom: 1px solid #3f3f3f;
            margin-bottom: 12px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 4px;
            transition: background-color 0.2s;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background-color: #272727;
        }

        .sidebar-item i {
            margin-right: 24px;
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .sidebar-title {
            padding: 8px 12px;
            font-size: 16px;
            font-weight: bold;
            color: #aaa;
            margin-top: 12px;
        }

        .sidebar-footer {
            padding: 16px 12px;
            font-size: 13px;
            color: #717171;
            line-height: 1.5;
        }

        /* Main content */
        .main-content {
            flex: 1;
            margin-left: 240px;
            min-height: 100vh;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            height: 56px;
            background-color: #0f0f0f;
            position: sticky;
            top: 0;
            z-index: 90;
            border-bottom: 1px solid #3f3f3f;
        }

        .search-container {
            display: flex;
            flex: 0 1 640px;
        }

        .search-input {
            flex: 1;
            padding: 10px 16px;
            background-color: #121212;
            border: 1px solid #303030;
            border-right: none;
            border-radius: 40px 0 0 40px;
            color: white;
            font-size: 16px;
        }

        .search-button {
            background-color: #222222;
            border: 1px solid #303030;
            border-left: none;
            border-radius: 0 40px 40px 0;
            padding: 8px 20px;
            cursor: pointer;
            color: #f1f1f1;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-btn {
            background: none;
            border: none;
            color: #f1f1f1;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header-btn:hover {
            background-color: #272727;
        }

        .upload-btn {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #ff0000;
            color: white;
            font-size: 10px;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            position: relative;
        }

        .user-avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Content sections */
        .content-section {
            padding: 24px;
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Home page */
        .home-container {
            padding: 24px;
        }

        .category-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .category-filter {
            background-color: #272727;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
        }

        .category-filter.active {
            background-color: white;
            color: black;
        }

        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        .video-card {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .video-card:hover {
            transform: scale(1.02);
        }

        .video-thumbnail-container {
            position: relative;
            width: 100%;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .video-info {
            display: flex;
            gap: 12px;
        }

        .channel-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            overflow: hidden;
        }

        .channel-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-details h3 {
            font-size: 16px;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-details p {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 4px;
        }

        /* Video player page */
        .player-container {
            display: flex;
            gap: 24px;
            padding: 24px;
        }

        .player-section {
            flex: 7;
        }

        .recommended-section {
            flex: 3;
        }

        .video-container {
            background-color: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
        }

        #main-video {
            width: 100%;
            height: 500px;
            display: block;
        }

        .video-info-container {
            padding: 16px 0;
            border-bottom: 1px solid #3f3f3f;
        }

        .video-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .video-actions {
            display: flex;
            gap: 16px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: #f1f1f1;
            cursor: pointer;
            padding: 8px;
            border-radius: 20px;
        }

        .action-btn:hover {
            background-color: #272727;
        }

        .channel-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #3f3f3f;
        }

        .channel-details {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subscribe-btn {
            background-color: #f1f1f1;
            color: #0f0f0f;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .subscribe-btn.subscribed {
            background-color: #272727;
            color: #f1f1f1;
        }

        /* Comments section */
        .comments-section {
            padding: 16px 0;
        }

        .comments-title {
            font-size: 18px;
            margin-bottom: 16px;
        }

        .comment-form {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .user-comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            overflow: hidden;
        }

        .user-comment-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .comment-input {
            background: none;
            border: none;
            border-bottom: 1px solid #3f3f3f;
            color: white;
            font-size: 14px;
            padding: 8px 0;
            margin-bottom: 8px;
        }

        .comment-input:focus {
            outline: none;
            border-bottom: 1px solid #3ea6ff;
        }

        .comment-submit-btn {
            align-self: flex-end;
            background-color: #3ea6ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .comment-item {
            display: flex;
            gap: 16px;
        }

        .comment-text {
            background-color: #272727;
            padding: 12px;
            border-radius: 8px;
            flex: 1;
            position: relative;
        }

        .comment-author {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .comment-content {
            font-size: 14px;
            line-height: 1.4;
        }

        /* Recommended videos */
        .recommended-title {
            font-size: 18px;
            margin-bottom: 16px;
        }

        .recommended-videos {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recommended-video {
            display: flex;
            gap: 8px;
            cursor: pointer;
        }

        .recommended-thumbnail {
            width: 168px;
            height: 94px;
            background-color: #272727;
            border-radius: 8px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .recommended-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recommended-info {
            flex: 1;
        }

        .recommended-video-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .recommended-channel, .recommended-stats {
            font-size: 12px;
            color: #aaa;
        }

        /* Shorts section */
        .shorts-container {
            padding: 24px;
        }

        .shorts-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            margin-bottom: 24px;
        }

        .shorts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .short-card {
            cursor: pointer;
        }

        .short-thumbnail {
            width: 100%;
            height: 320px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 8px;
            position: relative;
        }

        .short-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .short-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .short-views {
            font-size: 14px;
            color: #aaa;
        }

        /* Profile section */
        .profile-container {
            padding: 24px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #3f3f3f;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            overflow: hidden;
        }

        .profile-avatar-large-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .profile-stats {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 14px;
            color: #aaa;
        }

        .profile-edit-btn {
            background-color: #272727;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid #3f3f3f;
            padding-bottom: 8px;
        }

        .profile-tab {
            background: none;
            border: none;
            color: #aaa;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
        }

        .profile-tab.active {
            color: white;
            border-bottom-color: #ff0000;
        }

        .profile-videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* Library section */
        .library-container {
            padding: 24px;
        }

        .library-title {
            font-size: 20px;
            margin-bottom: 24px;
        }

        .library-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .library-action-btn {
            background-color: #272727;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .library-action-btn.active {
            background-color: #3ea6ff;
        }

        .library-content {
            min-height: 300px;
        }

        .empty-library {
            text-align: center;
            padding: 60px 20px;
            color: #aaa;
        }

        .empty-library i {
            font-size: 64px;
            margin-bottom: 16px;
            color: #3f3f3f;
        }

        /* History section */
        .history-container {
            padding: 24px;
        }

        .history-title {
            font-size: 20px;
            margin-bottom: 24px;
        }

        .history-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .history-clear-btn {
            background-color: #272727;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Upload modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background-color: #212121;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: #f1f1f1;
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            background-color: #121212;
            border: 1px solid #3f3f3f;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-upload {
            border: 2px dashed #3f3f3f;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload:hover {
            border-color: #3ea6ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #3ea6ff;
            margin-bottom: 16px;
        }

        .file-input {
            display: none;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-secondary {
            background-color: #3f3f3f;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Video management */
        .video-actions-menu {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .video-card:hover .video-actions-menu {
            opacity: 1;
        }

        .video-actions-dropdown {
            position: absolute;
            top: 40px;
            right: 0;
            background-color: #272727;
            border-radius: 8px;
            min-width: 180px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 10;
        }

        .video-actions-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background-color: #3f3f3f;
        }

        /* Profile dropdown */
        .profile-dropdown {
            position: absolute;
            top: 56px;
            right: 24px;
            background-color: #272727;
            border-radius: 8px;
            width: 280px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }

        .profile-dropdown.show {
            display: block;
        }

        .profile-dropdown-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #3f3f3f;
        }

        .profile-dropdown-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            overflow: hidden;
        }

        .profile-dropdown-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-dropdown-name {
            font-weight: bold;
            font-size: 16px;
        }

        .profile-dropdown-stats {
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            border-bottom: 1px solid #3f3f3f;
        }

        .dropdown-stat {
            text-align: center;
        }

        .dropdown-stat-value {
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        .dropdown-stat-label {
            font-size: 12px;
            color: #aaa;
            display: block;
        }

        .profile-dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-dropdown-item:hover {
            background-color: #3f3f3f;
        }

        /* Short badge */
        .short-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: #ff0000;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Video format indicator */
        .format-indicator {
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* Edit profile modal */
        .avatar-options {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .avatar-option {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .avatar-option.selected {
            border-color: #ff0000;
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-upload {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #121212;
            border: 2px dashed #3f3f3f;
        }

        /* Report modal */
        .report-reasons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .report-reason {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: #272727;
            border-radius: 8px;
            cursor: pointer;
        }

        .report-reason:hover {
            background-color: #3f3f3f;
        }

        .report-reason input[type="radio"] {
            width: 18px;
            height: 18px;
        }

        /* Comment actions */
        .comment-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 8px;
        }

        .comment-action-btn {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
        }

        .comment-action-btn:hover {
            color: white;
        }

        /* Authentication styles */
        .auth-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #3f3f3f;
        }

        .auth-tab {
            background: none;
            border: none;
            color: #aaa;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
            flex: 1;
            text-align: center;
        }

        .auth-tab.active {
            color: white;
            border-bottom-color: #ff0000;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Subscriptions page */
        .subscriptions-container {
            padding: 24px;
        }

        .subscriptions-title {
            font-size: 20px;
            margin-bottom: 24px;
        }

        .subscriptions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .subscription-channel-card {
            background-color: #272727;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .subscription-channel-card:hover {
            transform: translateY(-4px);
        }

        .subscription-channel-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 12px;
            overflow: hidden;
            background-color: #3ea6ff;
        }

        .subscription-channel-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .subscription-channel-name {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 16px;
        }

        .subscription-channel-stats {
            font-size: 12px;
            color: #aaa;
        }

        /* Search results */
        .search-results-container {
            padding: 24px;
        }

        .search-results-title {
            font-size: 20px;
            margin-bottom: 24px;
        }

        .search-results-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid #3f3f3f;
            padding-bottom: 8px;
        }

        .search-tab {
            background: none;
            border: none;
            color: #aaa;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
        }

        .search-tab.active {
            color: white;
            border-bottom-color: #ff0000;
        }

        /* Login button */
        .login-btn {
            background-color: #3ea6ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 72px;
                padding: 12px 4px;
            }
            
            .sidebar span, .sidebar-title {
                display: none;
            }
            
            .sidebar-item {
                justify-content: center;
                padding: 16px 0;
            }
            
            .sidebar-item i {
                margin-right: 0;
                font-size: 24px;
            }
            
            .main-content {
                margin-left: 72px;
            }
            
            .player-container {
                flex-direction: column;
            }
            
            #main-video {
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .search-container {
                flex: 0 1 300px;
            }
            
            #main-video {
                height: 300px;
            }
            
            .video-stats {
                flex-direction: column;
                gap: 8px;
            }
            
            .channel-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 0 12px;
            }
            
            .search-container {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar {
                display: none;
            }
            
            .home-container, .player-container {
                padding: 12px;
            }
            
            #main-video {
                height: 200px;
            }
            
            .videos-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fab fa-youtube"></i>
            <span>YOUREBE</span>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-item active" data-section="home">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </div>
            <div class="sidebar-item" data-section="shorts">
                <i class="fas fa-bolt"></i>
                <span>Shorts</span>
            </div>
            <div class="sidebar-item" data-section="subscriptions">
                <i class="fas fa-user-friends"></i>
                <span>Abonnements</span>
            </div>
        </div>
        
        <div class="sidebar-title">VOUS</div>
        <div class="sidebar-item" data-section="library">
            <i class="fas fa-book"></i>
            <span>Bibliothèque</span>
        </div>
        <div class="sidebar-item" data-section="history">
            <i class="fas fa-history"></i>
            <span>Historique</span>
        </div>
        
        <div class="sidebar-footer">
            <p>© 2023 YOUREBE</p>
            <p>Plateforme de partage vidéo</p>
        </div>
    </div>
    
    <!-- Main content -->
    <div class="main-content">
        <!-- Header -->
        <header>
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Rechercher vidéos, chaînes...">
                <button class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div class="header-right">
                <button class="upload-btn" id="open-upload-modal">
                    <i class="fas fa-upload"></i>
                    Importer
                </button>
                <div class="user-avatar" id="user-menu-btn">
                    <!-- Avatar will be loaded here -->
                </div>
            </div>
        </header>
        
        <!-- Profile dropdown -->
        <div class="profile-dropdown" id="profile-dropdown">
            <div class="profile-dropdown-header">
                <div class="profile-dropdown-avatar" id="dropdown-avatar">
                    <!-- Avatar will be loaded here -->
                </div>
                <div class="profile-dropdown-name" id="dropdown-name">Non connecté</div>
            </div>
            
            <div class="profile-dropdown-stats">
                <div class="dropdown-stat">
                    <span class="dropdown-stat-value" id="dropdown-videos">0</span>
                    <span class="dropdown-stat-label">Vidéos</span>
                </div>
                <div class="dropdown-stat">
                    <span class="dropdown-stat-value" id="dropdown-views">0</span>
                    <span class="dropdown-stat-label">Vues</span>
                </div>
                <div class="dropdown-stat">
                    <span class="dropdown-stat-value" id="dropdown-subscribers">0</span>
                    <span class="dropdown-stat-label">Abonnés</span>
                </div>
            </div>
            
            <div class="profile-dropdown-item" id="view-profile-btn">
                <i class="fas fa-user"></i>
                <span>Voir mon profil</span>
            </div>
            <div class="profile-dropdown-item" id="edit-profile-btn">
                <i class="fas fa-edit"></i>
                <span>Modifier mon profil</span>
            </div>
            <div class="profile-dropdown-item" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </div>
        </div>
        
        <!-- Home section -->
        <div class="content-section active" id="home-section">
            <div class="home-container">
                <div class="category-filters">
                    <button class="category-filter active" data-category="all">Tous</button>
                    <button class="category-filter" data-category="music">Musique</button>
                    <button class="category-filter" data-category="gaming">Gaming</button>
                    <button class="category-filter" data-category="tech">Technologie</button>
                    <button class="category-filter" data-category="cooking">Cuisine</button>
                    <button class="category-filter" data-category="sports">Sport</button>
                    <button class="category-filter" data-category="education">Éducation</button>
                    <button class="category-filter" data-category="entertainment">Divertissement</button>
                </div>
                
                <div class="videos-grid" id="videos-grid">
                    <!-- Videos will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Shorts section -->
        <div class="content-section" id="shorts-section">
            <div class="shorts-container">
                <div class="shorts-title">
                    <i class="fas fa-bolt"></i>
                    <span>Shorts</span>
                </div>
                <div class="shorts-grid" id="shorts-grid">
                    <!-- Shorts will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Subscriptions section -->
        <div class="content-section" id="subscriptions-section">
            <div class="subscriptions-container">
                <h2 class="subscriptions-title">Abonnements</h2>
                <div class="subscriptions-grid" id="subscriptions-grid">
                    <!-- Subscriptions will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Search results section -->
        <div class="content-section" id="search-section">
            <div class="search-results-container">
                <h2 class="search-results-title" id="search-results-title">Résultats de recherche</h2>
                <div class="search-results-tabs">
                    <button class="search-tab active" data-search-tab="videos">Vidéos</button>
                    <button class="search-tab" data-search-tab="channels">Chaînes</button>
                </div>
                <div id="search-videos-results">
                    <!-- Search video results will be loaded here -->
                </div>
                <div id="search-channels-results" style="display: none;">
                    <!-- Search channel results will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Profile section -->
        <div class="content-section" id="profile-section">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profile-large-avatar">
                        <!-- Avatar will be loaded here -->
                    </div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="profile-display-name">Non connecté</h1>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="profile-total-videos">0</span>
                                <span class="stat-label">Vidéos</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="profile-total-views">0</span>
                                <span class="stat-label">Vues totales</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="profile-subscribers">0</span>
                                <span class="stat-label">Abonnés</span>
                            </div>
                        </div>
                    </div>
                    <button class="profile-edit-btn" id="edit-profile-from-page">
                        <i class="fas fa-edit"></i>
                        <span>Modifier le profil</span>
                    </button>
                </div>
                
                <div class="profile-tabs">
                    <button class="profile-tab active" data-profile-tab="videos">Vidéos</button>
                    <button class="profile-tab" data-profile-tab="shorts">Shorts</button>
                </div>
                
                <div class="profile-videos-grid" id="profile-videos-container">
                    <!-- Profile videos will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Library section -->
        <div class="content-section" id="library-section">
            <div class="library-container">
                <h2 class="library-title">Bibliothèque</h2>
                <div class="library-actions">
                    <button class="library-action-btn active" data-library-tab="my-videos">
                        <i class="fas fa-video"></i>
                        <span>Mes vidéos</span>
                    </button>
                    <button class="library-action-btn" data-library-tab="liked-videos">
                        <i class="fas fa-thumbs-up"></i>
                        <span>Vidéos aimées</span>
                    </button>
                    <button class="library-action-btn" data-library-tab="playlists">
                        <i class="fas fa-list"></i>
                        <span>Playlists</span>
                    </button>
                </div>
                <div class="library-content" id="library-content">
                    <!-- Library content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- History section -->
        <div class="content-section" id="history-section">
            <div class="history-container">
                <h2 class="history-title">Historique</h2>
                <div class="history-actions">
                    <button class="history-clear-btn" id="clear-history">
                        <i class="fas fa-trash"></i>
                        <span>Effacer l'historique</span>
                    </button>
                </div>
                <div class="videos-grid" id="history-grid">
                    <!-- History videos will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Video player section -->
        <div class="content-section" id="player-section">
            <div class="player-container">
                <div class="player-section">
                    <div class="video-container">
                        <video id="main-video" controls>
                            <source id="video-source" src="" type="video/mp4">
                            Votre navigateur ne supporte pas la balise vidéo.
                        </video>
                    </div>
                    
                    <div class="video-info-container">
                        <h1 class="video-title" id="video-title"></h1>
                        <div class="video-stats">
                            <span id="video-views"></span>
                            <span id="video-date"></span>
                        </div>
                        <div class="video-actions">
                            <button class="action-btn" id="like-btn">
                                <i class="fas fa-thumbs-up"></i>
                                <span id="like-count">0</span>
                            </button>
                            <button class="action-btn" id="dislike-btn">
                                <i class="fas fa-thumbs-down"></i>
                                <span>Pas pour moi</span>
                            </button>
                            <button class="action-btn" id="share-btn">
                                <i class="fas fa-share"></i>
                                <span>Partager</span>
                            </button>
                            <button class="action-btn" id="save-btn">
                                <i class="fas fa-bookmark"></i>
                                <span>Sauvegarder</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="channel-info">
                        <div class="channel-details">
                            <div class="channel-avatar" id="channel-avatar"></div>
                            <div>
                                <div class="channel-name" id="channel-name"></div>
                                <div class="subscriber-count" id="subscriber-count"></div>
                            </div>
                        </div>
                        <button class="subscribe-btn" id="subscribe-btn">S'abonner</button>
                    </div>
                    
                    <div class="comments-section">
                        <h3 class="comments-title" id="comments-count">0 commentaire</h3>
                        
                        <div class="comment-form">
                            <div class="user-comment-avatar" id="comment-user-avatar">
                                <!-- User avatar will be loaded here -->
                            </div>
                            <div class="comment-input-container">
                                <input type="text" class="comment-input" id="comment-input" placeholder="Ajouter un commentaire public...">
                                <button class="comment-submit-btn" id="comment-submit-btn">Commenter</button>
                            </div>
                        </div>
                        
                        <div class="comment-list" id="comment-list">
                            <!-- Comments will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="recommended-section">
                    <h3 class="recommended-title">À suivre</h3>
                    <div class="recommended-videos" id="recommended-videos">
                        <!-- Recommended videos will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upload modal -->
    <div class="modal-overlay" id="upload-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Importer une vidéo</h2>
                <button class="close-modal" id="close-upload-modal">&times;</button>
            </div>
            
            <form id="upload-form">
                <div class="form-group">
                    <label for="video-file" class="form-label">Sélectionner une vidéo</label>
                    <div class="file-upload" id="file-upload-area">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Glissez-déposez votre fichier vidéo ici ou cliquez pour parcourir</p>
                        <input type="file" id="video-file" class="file-input" accept="video/*">
                    </div>
                    <p id="file-name" style="margin-top: 8px; font-size: 14px; color: #aaa;"></p>
                </div>
                
                <div class="form-group">
                    <label for="video-title-input" class="form-label">Titre de la vidéo</label>
                    <input type="text" id="video-title-input" class="form-input" placeholder="Titre accrocheur..." required>
                </div>
                
                <div class="form-group">
                    <label for="video-description" class="form-label">Description</label>
                    <textarea id="video-description" class="form-textarea" placeholder="Décrivez votre vidéo..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="video-category" class="form-label">Catégorie</label>
                    <select id="video-category" class="form-input">
                        <option value="general">Général</option>
                        <option value="music">Musique</option>
                        <option value="gaming">Gaming</option>
                        <option value="tech">Technologie</option>
                        <option value="cooking">Cuisine</option>
                        <option value="sports">Sport</option>
                        <option value="education">Éducation</option>
                        <option value="entertainment">Divertissement</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="video-thumbnail-upload" class="form-label">Miniature (optionnel)</label>
                    <input type="file" id="video-thumbnail-upload" class="form-input" accept="image/*">
                    <p style="margin-top: 8px; font-size: 14px; color: #aaa;">Vous pouvez également ajouter une miniature plus tard en modifiant la vidéo</p>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-upload">Annuler</button>
                    <button type="submit" class="btn-primary">Publier la vidéo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit profile modal -->
    <div class="modal-overlay" id="profile-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Modifier le profil</h2>
                <button class="close-modal" id="close-profile-modal">&times;</button>
            </div>
            
            <form id="profile-form">
                <div class="form-group">
                    <label for="profile-name-input" class="form-label">Nom d'utilisateur</label>
                    <input type="text" id="profile-name-input" class="form-input" placeholder="Votre nom d'utilisateur..." required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Avatar</label>
                    <div class="avatar-options" id="avatar-options">
                        <!-- Avatar options will be loaded here -->
                    </div>
                    <p style="margin-top: 8px; font-size: 14px; color: #aaa;">Ou téléchargez votre propre image :</p>
                    <input type="file" id="custom-avatar" class="form-input" accept="image/*" style="margin-top: 8px;">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-profile">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer les modifications</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Authentication Modal -->
    <div class="modal-overlay" id="auth-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Connexion / Inscription</h2>
                <button class="close-modal" id="close-auth-modal">&times;</button>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-auth-tab="login">Connexion</button>
                <button class="auth-tab" data-auth-tab="signup">Inscription</button>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-email" class="form-label">Email</label>
                    <input type="email" id="login-email" class="form-input" placeholder="votre@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="login-password" class="form-label">Mot de passe</label>
                    <input type="password" id="login-password" class="form-input" placeholder="Votre mot de passe" required>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn-primary" style="width: 100%;">Se connecter</button>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form id="signup-form" class="auth-form">
                <div class="form-group">
                    <label for="signup-username" class="form-label">Nom d'utilisateur</label>
                    <input type="text" id="signup-username" class="form-input" placeholder="Votre pseudonyme" required>
                </div>
                
                <div class="form-group">
                    <label for="signup-email" class="form-label">Email</label>
                    <input type="email" id="signup-email" class="form-input" placeholder="votre@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="signup-password" class="form-label">Mot de passe</label>
                    <input type="password" id="signup-password" class="form-input" placeholder="Minimum 6 caractères" required minlength="6">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn-primary" style="width: 100%;">Créer un compte</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Thumbnail editor modal -->
    <div class="modal-overlay" id="thumbnail-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Modifier la miniature</h2>
                <button class="close-modal" id="close-thumbnail-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Choisir une miniature</label>
                <div class="thumbnail-options" id="thumbnail-selector">
                    <!-- Thumbnail options will be loaded here -->
                </div>
                <p style="margin-top: 12px; font-size: 14px; color: #aaa;">Ou téléchargez votre propre image :</p>
                <input type="file" id="new-thumbnail" class="form-input" accept="image/*" style="margin-top: 8px;">
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn-secondary" id="cancel-thumbnail">Annuler</button>
                <button type="button" class="btn-primary" id="save-thumbnail">Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Report modal -->
    <div class="modal-overlay" id="report-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Signaler un contenu</h2>
                <button class="close-modal" id="close-report-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <p>Veuillez sélectionner une raison pour signaler cette vidéo :</p>
                <div class="report-reasons" id="report-reasons">
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="spam">
                        <span>Spam ou tromperie</span>
                    </label>
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="nudity">
                        <span>Contenu sexuel ou nudité</span>
                    </label>
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="violence">
                        <span>Violence ou contenu choquant</span>
                    </label>
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="harassment">
                        <span>Harcèlement ou intimidation</span>
                    </label>
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="copyright">
                        <span>Violation de droits d'auteur</span>
                    </label>
                    <label class="report-reason">
                        <input type="radio" name="report-reason" value="other">
                        <span>Autre</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="report-details" class="form-label">Détails supplémentaires (optionnel)</label>
                    <textarea id="report-details" class="form-textarea" placeholder="Fournissez plus de détails sur le problème..."></textarea>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn-secondary" id="cancel-report">Annuler</button>
                <button type="button" class="btn-primary" id="submit-report">Signaler</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration Supabase - REMPLACEZ CES VALEURS !
        const SUPABASE_URL = 'https://VOTRE_ID_SUPABASE.supabase.co';  // Remplacez par votre URL
        const SUPABASE_ANON_KEY = 'VOTRE_CLÉ_ANON_PUBLIQUE';  // Remplacez par votre clé anon
        
        // Initialiser Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Clé pour le stockage local (pour les préférences utilisateur)
        const STORAGE_KEYS = {
            USER_PROFILE: 'yourebe_user_profile',
            LIKED_VIDEOS: 'yourebe_liked_videos',
            SAVED_VIDEOS: 'yourebe_saved_videos',
            HISTORY: 'yourebe_history',
            SUBSCRIPTIONS: 'yourebe_subscriptions'
        };

        // Gestion des données avec Supabase
        class YourebeApp {
            constructor() {
                this.currentUser = null;
                this.currentVideoId = null;
                this.currentSection = "home";
                this.libraryTab = "my-videos";
                this.profileTab = "videos";
                this.searchTab = "videos";
                
                // Charger les préférences locales
                this.loadLocalPreferences();
            }
            
            loadLocalPreferences() {
                this.likedVideos = this.loadFromStorage(STORAGE_KEYS.LIKED_VIDEOS) || [];
                this.savedVideos = this.loadFromStorage(STORAGE_KEYS.SAVED_VIDEOS) || [];
                this.watchHistory = this.loadFromStorage(STORAGE_KEYS.HISTORY) || [];
                this.localSubscriptions = this.loadFromStorage(STORAGE_KEYS.SUBSCRIPTIONS) || [];
                
                // Charger le profil utilisateur local
                const localProfile = this.loadFromStorage(STORAGE_KEYS.USER_PROFILE);
                if (localProfile) {
                    this.currentUser = localProfile;
                }
            }
            
            // Stockage local pour les préférences
            saveToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error('Erreur de sauvegarde:', e);
                }
            }
            
            loadFromStorage(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Erreur de chargement:', e);
                    return null;
                }
            }
            
            // Authentification
            async signUp(email, password, username) {
                try {
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                username: username
                            }
                        }
                    });
                    
                    if (error) throw error;
                    
                    // Créer le profil utilisateur
                    if (data.user) {
                        await this.createUserProfile(data.user.id, username);
                        this.currentUser = {
                            id: data.user.id,
                            username: username,
                            email: email,
                            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}&backgroundColor=3ea6ff`,
                            subscribers: 0
                        };
                        this.saveToStorage(STORAGE_KEYS.USER_PROFILE, this.currentUser);
                    }
                    
                    return { success: true, user: data.user };
                } catch (error) {
                    console.error('Erreur inscription:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async signIn(email, password) {
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    // Récupérer le profil utilisateur
                    const profile = await this.getUserProfile(data.user.id);
                    this.currentUser = {
                        id: data.user.id,
                        username: profile.username,
                        email: data.user.email,
                        avatar: profile.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${profile.username}&backgroundColor=3ea6ff`,
                        subscribers: profile.subscribers || 0
                    };
                    this.saveToStorage(STORAGE_KEYS.USER_PROFILE, this.currentUser);
                    
                    return { success: true, user: this.currentUser };
                } catch (error) {
                    console.error('Erreur connexion:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async signOut() {
                try {
                    const { error } = await supabase.auth.signOut();
                    if (error) throw error;
                    
                    this.currentUser = null;
                    localStorage.removeItem(STORAGE_KEYS.USER_PROFILE);
                    return { success: true };
                } catch (error) {
                    console.error('Erreur déconnexion:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async getCurrentSession() {
                try {
                    const { data, error } = await supabase.auth.getSession();
                    if (error) throw error;
                    
                    if (data.session) {
                        const profile = await this.getUserProfile(data.session.user.id);
                        this.currentUser = {
                            id: data.session.user.id,
                            username: profile.username,
                            email: data.session.user.email,
                            avatar: profile.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${profile.username}&backgroundColor=3ea6ff`,
                            subscribers: profile.subscribers || 0
                        };
                        this.saveToStorage(STORAGE_KEYS.USER_PROFILE, this.currentUser);
                        return this.currentUser;
                    }
                    return null;
                } catch (error) {
                    console.error('Erreur session:', error);
                    return null;
                }
            }
            
            // Profil utilisateur
            async createUserProfile(userId, username) {
                try {
                    const { error } = await supabase
                        .from('users')
                        .insert([{
                            id: userId,
                            username: username,
                            avatar_url: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}&backgroundColor=3ea6ff`,
                            subscribers: 0
                        }]);
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    console.error('Erreur création profil:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async getUserProfile(userId) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', userId)
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Erreur profil:', error);
                    return { username: 'Utilisateur', avatar_url: '', subscribers: 0 };
                }
            }
            
            async updateProfile(updates) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    
                    const { error } = await supabase
                        .from('users')
                        .update(updates)
                        .eq('id', this.currentUser.id);
                    
                    if (error) throw error;
                    
                    // Mettre à jour l'utilisateur local
                    this.currentUser = { ...this.currentUser, ...updates };
                    this.saveToStorage(STORAGE_KEYS.USER_PROFILE, this.currentUser);
                    
                    return { success: true };
                } catch (error) {
                    console.error('Erreur mise à jour profil:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Vidéos
            async addVideo(videoData) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    
                    // Upload de la vidéo si elle existe
                    let videoUrl = videoData.videoUrl;
                    if (videoData.videoFile) {
                        const uploadResult = await this.uploadVideoFile(videoData.videoFile);
                        if (!uploadResult.success) throw new Error(uploadResult.error);
                        videoUrl = uploadResult.url;
                    }
                    
                    // Upload de la miniature si elle existe
                    let thumbnailUrl = videoData.thumbnail;
                    if (videoData.thumbnailFile) {
                        const thumbnailResult = await this.uploadThumbnailFile(videoData.thumbnailFile);
                        if (!thumbnailResult.success) throw new Error(thumbnailResult.error);
                        thumbnailUrl = thumbnailResult.url;
                    }
                    
                    const { data, error } = await supabase
                        .from('videos')
                        .insert([{
                            title: videoData.title,
                            description: videoData.description,
                            video_url: videoUrl,
                            thumbnail_url: thumbnailUrl,
                            duration: videoData.duration,
                            category: videoData.category,
                            is_short: videoData.isShort,
                            aspect_ratio: videoData.aspectRatio,
                            user_id: this.currentUser.id
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, video: data };
                } catch (error) {
                    console.error('Erreur ajout vidéo:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async getVideos(limit = 50, category = 'all') {
                try {
                    let query = supabase
                        .from('videos')
                        .select(`
                            *,
                            user:users(username, avatar_url, subscribers)
                        `)
                        .order('created_at', { ascending: false })
                        .limit(limit);
                    
                    if (category !== 'all') {
                        query = query.eq('category', category);
                    }
                    
                    const { data, error } = await query;
                    
                    if (error) throw error;
                    
                    // Formater les données
                    const formattedVideos = data.map(video => ({
                        id: video.id,
                        title: video.title,
                        description: video.description,
                        views: video.views,
                        likes: video.likes,
                        dislikes: video.dislikes,
                        comments: video.comments_count,
                        channel: video.user.username,
                        channelId: video.user.id,
                        channelAvatar: video.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${video.user.username}&backgroundColor=3ea6ff`,
                        subscribers: video.user.subscribers.toString(),
                        date: new Date(video.created_at).toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        }),
                        videoUrl: video.video_url,
                        thumbnail: video.thumbnail_url,
                        duration: video.duration,
                        category: video.category,
                        isShort: video.is_short,
                        aspectRatio: video.aspect_ratio,
                        uploadedByUser: this.currentUser && video.user_id === this.currentUser.id,
                        saved: this.savedVideos.includes(video.id),
                        createdAt: video.created_at
                    }));
                    
                    return formattedVideos;
                } catch (error) {
                    console.error('Erreur récupération vidéos:', error);
                    return [];
                }
            }
            
            async getShorts(limit = 50) {
                try {
                    const { data, error } = await supabase
                        .from('videos')
                        .select(`
                            *,
                            user:users(username, avatar_url, subscribers)
                        `)
                        .eq('is_short', true)
                        .order('created_at', { ascending: false })
                        .limit(limit);
                    
                    if (error) throw error;
                    
                    return data.map(video => ({
                        id: video.id,
                        title: video.title,
                        description: video.description,
                        views: video.views,
                        likes: video.likes,
                        dislikes: video.dislikes,
                        comments: video.comments_count,
                        channel: video.user.username,
                        channelId: video.user.id,
                        channelAvatar: video.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${video.user.username}&backgroundColor=3ea6ff`,
                        subscribers: video.user.subscribers.toString(),
                        date: new Date(video.created_at).toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        }),
                        videoUrl: video.video_url,
                        thumbnail: video.thumbnail_url,
                        duration: video.duration,
                        category: video.category,
                        isShort: video.is_short,
                        aspectRatio: video.aspect_ratio,
                        uploadedByUser: this.currentUser && video.user_id === this.currentUser.id,
                        saved: this.savedVideos.includes(video.id),
                        createdAt: video.created_at
                    }));
                } catch (error) {
                    console.error('Erreur récupération shorts:', error);
                    return [];
                }
            }
            
            async getVideoById(id) {
                try {
                    const { data, error } = await supabase
                        .from('videos')
                        .select(`
                            *,
                            user:users(username, avatar_url, subscribers)
                        `)
                        .eq('id', id)
                        .single();
                    
                    if (error) throw error;
                    
                    return {
                        id: data.id,
                        title: data.title,
                        description: data.description,
                        views: data.views,
                        likes: data.likes,
                        dislikes: data.dislikes,
                        comments: data.comments_count,
                        channel: data.user.username,
                        channelId: data.user.id,
                        channelAvatar: data.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${data.user.username}&backgroundColor=3ea6ff`,
                        subscribers: data.user.subscribers.toString(),
                        date: new Date(data.created_at).toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        }),
                        videoUrl: data.video_url,
                        thumbnail: data.thumbnail_url,
                        duration: data.duration,
                        category: data.category,
                        isShort: data.is_short,
                        aspectRatio: data.aspect_ratio,
                        uploadedByUser: this.currentUser && data.user_id === this.currentUser.id,
                        saved: this.savedVideos.includes(data.id),
                        createdAt: data.created_at
                    };
                } catch (error) {
                    console.error('Erreur récupération vidéo:', error);
                    return null;
                }
            }
            
            async updateVideo(id, updates) {
                try {
                    const { error } = await supabase
                        .from('videos')
                        .update(updates)
                        .eq('id', id);
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    console.error('Erreur mise à jour vidéo:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async deleteVideo(id) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    
                    // Vérifier que l'utilisateur est propriétaire
                    const video = await this.getVideoById(id);
                    if (!video || video.channelId !== this.currentUser.id) {
                        throw new Error('Vous ne pouvez supprimer que vos propres vidéos');
                    }
                    
                    const { error } = await supabase
                        .from('videos')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    // Supprimer des listes locales
                    this.likedVideos = this.likedVideos.filter(vid => vid !== id);
                    this.savedVideos = this.savedVideos.filter(vid => vid !== id);
                    this.saveToStorage(STORAGE_KEYS.LIKED_VIDEOS, this.likedVideos);
                    this.saveToStorage(STORAGE_KEYS.SAVED_VIDEOS, this.savedVideos);
                    
                    return { success: true };
                } catch (error) {
                    console.error('Erreur suppression vidéo:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async incrementViews(videoId) {
                try {
                    const { error } = await supabase.rpc('increment_views', {
                        video_id: videoId
                    });
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    console.error('Erreur incrément vues:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Upload de fichiers
            async uploadVideoFile(file) {
                try {
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Math.random().toString(36).substring(2)}_${Date.now()}.${fileExt}`;
                    const filePath = `videos/${fileName}`;
                    
                    const { data, error } = await supabase.storage
                        .from('videos')
                        .upload(filePath, file);
                    
                    if (error) throw error;
                    
                    // Récupérer l'URL publique
                    const { data: { publicUrl } } = supabase.storage
                        .from('videos')
                        .getPublicUrl(filePath);
                    
                    return { success: true, url: publicUrl };
                } catch (error) {
                    console.error('Erreur upload vidéo:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async uploadThumbnailFile(file) {
                try {
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Math.random().toString(36).substring(2)}_${Date.now()}.${fileExt}`;
                    const filePath = `thumbnails/${fileName}`;
                    
                    const { data, error } = await supabase.storage
                        .from('thumbnails')
                        .upload(filePath, file);
                    
                    if (error) throw error;
                    
                    // Récupérer l'URL publique
                    const { data: { publicUrl } } = supabase.storage
                        .from('thumbnails')
                        .getPublicUrl(filePath);
                    
                    return { success: true, url: publicUrl };
                } catch (error) {
                    console.error('Erreur upload miniature:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Commentaires
            async addComment(videoId, content) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    
                    const { data, error } = await supabase
                        .from('comments')
                        .insert([{
                            video_id: videoId,
                            user_id: this.currentUser.id,
                            content: content
                        }])
                        .select(`
                            *,
                            user:users(username, avatar_url)
                        `)
                        .single();
                    
                    if (error) throw error;
                    
                    // Incrémenter le compteur de commentaires
                    await this.updateVideo(videoId, { comments_count: data.comments_count + 1 });
                    
                    return {
                        id: data.id,
                        author: data.user.username,
                        authorAvatar: data.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${data.user.username}&backgroundColor=3ea6ff`,
                        content: data.content,
                        time: "À l'instant",
                        canDelete: true
                    };
                } catch (error) {
                    console.error('Erreur ajout commentaire:', error);
                    return null;
                }
            }
            
            async getCommentsForVideo(videoId) {
                try {
                    const { data, error } = await supabase
                        .from('comments')
                        .select(`
                            *,
                            user:users(username, avatar_url)
                        `)
                        .eq('video_id', videoId)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    
                    return data.map(comment => ({
                        id: comment.id,
                        author: comment.user.username,
                        authorAvatar: comment.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${comment.user.username}&backgroundColor=3ea6ff`,
                        content: comment.content,
                        time: this.formatTimeAgo(new Date(comment.created_at)),
                        canDelete: this.currentUser && comment.user_id === this.currentUser.id
                    }));
                } catch (error) {
                    console.error('Erreur récupération commentaires:', error);
                    return [];
                }
            }
            
            async deleteComment(commentId) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    
                    const { error } = await supabase
                        .from('comments')
                        .delete()
                        .eq('id', commentId);
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    console.error('Erreur suppression commentaire:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Abonnements
            async toggleSubscription(channelId) {
                try {
                    if (!this.currentUser) throw new Error('Non connecté');
                    if (this.currentUser.id === channelId) throw new Error('Vous ne pouvez pas vous abonner à vous-même');
                    
                    // Vérifier si déjà abonné
                    const { data: existing, error: checkError } = await supabase
                        .from('subscriptions')
                        .select('id')
                        .eq('subscriber_id', this.currentUser.id)
                        .eq('channel_id', channelId)
                        .single();
                    
                    if (checkError && checkError.code !== 'PGRST116') throw checkError;
                    
                    if (existing) {
                        // Se désabonner
                        const { error } = await supabase
                            .from('subscriptions')
                            .delete()
                            .eq('id', existing.id);
                        
                        if (error) throw error;
                        
                        // Décrémenter les abonnés
                        await supabase.rpc('decrement_subscribers', { user_id: channelId });
                        
                        // Mettre à jour le local storage
                        this.localSubscriptions = this.localSubscriptions.filter(id => id !== channelId);
                        this.saveToStorage(STORAGE_KEYS.SUBSCRIPTIONS, this.localSubscriptions);
                        
                        return { success: true, subscribed: false };
                    } else {
                        // S'abonner
                        const { error } = await supabase
                            .from('subscriptions')
                            .insert([{
                                subscriber_id: this.currentUser.id,
                                channel_id: channelId
                            }]);
                        
                        if (error) throw error;
                        
                        // Incrémenter les abonnés
                        await supabase.rpc('increment_subscribers', { user_id: channelId });
                        
                        // Mettre à jour le local storage
                        this.localSubscriptions.push(channelId);
                        this.saveToStorage(STORAGE_KEYS.SUBSCRIPTIONS, this.localSubscriptions);
                        
                        return { success: true, subscribed: true };
                    }
                } catch (error) {
                    console.error('Erreur abonnement:', error);
                    return { success: false, error: error.message };
                }
            }
            
            async isSubscribed(channelId) {
                // Vérifier d'abord dans le local storage
                if (this.localSubscriptions.includes(channelId)) {
                    return true;
                }
                
                try {
                    if (!this.currentUser) return false;
                    
                    const { data, error } = await supabase
                        .from('subscriptions')
                        .select('id')
                        .eq('subscriber_id', this.currentUser.id)
                        .eq('channel_id', channelId)
                        .single();
                    
                    if (error && error.code !== 'PGRST116') throw error;
                    
                    return !!data;
                } catch (error) {
                    console.error('Erreur vérification abonnement:', error);
                    return false;
                }
            }
            
            async getSubscribedChannels() {
                try {
                    if (!this.currentUser) return [];
                    
                    const { data, error } = await supabase
                        .from('subscriptions')
                        .select(`
                            channel:users!subscriptions_channel_id_fkey(
                                id,
                                username,
                                avatar_url,
                                subscribers
                            )
                        `)
                        .eq('subscriber_id', this.currentUser.id);
                    
                    if (error) throw error;
                    
                    return data.map(item => item.channel);
                } catch (error) {
                    console.error('Erreur récupération abonnements:', error);
                    return [];
                }
            }
            
            // Recherche
            async searchVideos(query) {
                try {
                    const { data, error } = await supabase
                        .from('videos')
                        .select(`
                            *,
                            user:users(username, avatar_url, subscribers)
                        `)
                        .or(`title.ilike.%${query}%,description.ilike.%${query}%`)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    
                    return data.map(video => ({
                        id: video.id,
                        title: video.title,
                        description: video.description,
                        views: video.views,
                        likes: video.likes,
                        dislikes: video.dislikes,
                        comments: video.comments_count,
                        channel: video.user.username,
                        channelId: video.user.id,
                        channelAvatar: video.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${video.user.username}&backgroundColor=3ea6ff`,
                        subscribers: video.user.subscribers.toString(),
                        date: new Date(video.created_at).toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        }),
                        videoUrl: video.video_url,
                        thumbnail: video.thumbnail_url,
                        duration: video.duration,
                        category: video.category,
                        isShort: video.is_short,
                        aspectRatio: video.aspect_ratio,
                        uploadedByUser: this.currentUser && video.user_id === this.currentUser.id,
                        saved: this.savedVideos.includes(video.id),
                        createdAt: video.created_at
                    }));
                } catch (error) {
                    console.error('Erreur recherche vidéos:', error);
                    return [];
                }
            }
            
            async searchChannels(query) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .ilike('username', `%${query}%`)
                        .order('subscribers', { ascending: false });
                    
                    if (error) throw error;
                    
                    return data.map(user => ({
                        id: user.id,
                        username: user.username,
                        avatar: user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}&backgroundColor=3ea6ff`,
                        subscribers: user.subscribers,
                        description: "Chaîne de partage vidéo"
                    }));
                } catch (error) {
                    console.error('Erreur recherche chaînes:', error);
                    return [];
                }
            }
            
            // Récupérer les vidéos de l'utilisateur
            async getUserVideos() {
                try {
                    if (!this.currentUser) return [];
                    
                    const { data, error } = await supabase
                        .from('videos')
                        .select(`
                            *,
                            user:users(username, avatar_url, subscribers)
                        `)
                        .eq('user_id', this.currentUser.id)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    
                    return data.map(video => ({
                        id: video.id,
                        title: video.title,
                        description: video.description,
                        views: video.views,
                        likes: video.likes,
                        dislikes: video.dislikes,
                        comments: video.comments_count,
                        channel: video.user.username,
                        channelId: video.user.id,
                        channelAvatar: video.user.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${video.user.username}&backgroundColor=3ea6ff`,
                        subscribers: video.user.subscribers.toString(),
                        date: new Date(video.created_at).toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric' 
                        }),
                        videoUrl: video.video_url,
                        thumbnail: video.thumbnail_url,
                        duration: video.duration,
                        category: video.category,
                        isShort: video.is_short,
                        aspectRatio: video.aspect_ratio,
                        uploadedByUser: true,
                        saved: this.savedVideos.includes(video.id),
                        createdAt: video.created_at
                    }));
                } catch (error) {
                    console.error('Erreur récupération vidéos utilisateur:', error);
                    return [];
                }
            }
            
            // Utilitaires
            formatTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffSec = Math.floor(diffMs / 1000);
                const diffMin = Math.floor(diffSec / 60);
                const diffHour = Math.floor(diffMin / 60);
                const diffDay = Math.floor(diffHour / 24);
                
                if (diffSec < 60) return "À l'instant";
                if (diffMin < 60) return `Il y a ${diffMin} minute${diffMin > 1 ? 's' : ''}`;
                if (diffHour < 24) return `Il y a ${diffHour} heure${diffHour > 1 ? 's' : ''}`;
                if (diffDay < 7) return `Il y a ${diffDay} jour${diffDay > 1 ? 's' : ''}`;
                return date.toLocaleDateString('fr-FR');
            }
            
            // Gestion locale des likes/sauvegardes/historique
            toggleLike(videoId) {
                const index = this.likedVideos.indexOf(videoId);
                
                if (index === -1) {
                    this.likedVideos.push(videoId);
                } else {
                    this.likedVideos.splice(index, 1);
                }
                
                this.saveToStorage(STORAGE_KEYS.LIKED_VIDEOS, this.likedVideos);
                return index === -1;
            }
            
            toggleSave(videoId) {
                const index = this.savedVideos.indexOf(videoId);
                
                if (index === -1) {
                    this.savedVideos.push(videoId);
                } else {
                    this.savedVideos.splice(index, 1);
                }
                
                this.saveToStorage(STORAGE_KEYS.SAVED_VIDEOS, this.savedVideos);
                return index === -1;
            }
            
            addToHistory(videoId) {
                this.watchHistory = this.watchHistory.filter(id => id !== videoId);
                this.watchHistory.unshift(videoId);
                
                if (this.watchHistory.length > 50) {
                    this.watchHistory.pop();
                }
                
                this.saveToStorage(STORAGE_KEYS.HISTORY, this.watchHistory);
            }
            
            clearHistory() {
                this.watchHistory = [];
                this.saveToStorage(STORAGE_KEYS.HISTORY, this.watchHistory);
            }
            
            isLiked(videoId) {
                return this.likedVideos.includes(videoId);
            }
            
            isSaved(videoId) {
                return this.savedVideos.includes(videoId);
            }
            
            // Vérifier si l'utilisateur est propriétaire d'une vidéo
            isVideoOwner(videoId) {
                const video = this.getVideoById(videoId);
                return video && video.channelId === this.currentUser.id;
            }
        }

        // Initialiser l'application
        const app = new YourebeApp();
        
        // DOM Elements
        const mainVideo = document.getElementById('main-video');
        const videoSource = document.getElementById('video-source');
        const videoTitle = document.getElementById('video-title');
        const videoViews = document.getElementById('video-views');
        const likeCount = document.getElementById('like-count');
        const commentsCount = document.getElementById('comments-count');
        const commentList = document.getElementById('comment-list');
        const commentInput = document.getElementById('comment-input');
        const commentSubmitBtn = document.getElementById('comment-submit-btn');
        const commentUserAvatar = document.getElementById('comment-user-avatar');
        const recommendedVideosContainer = document.getElementById('recommended-videos');
        const videosGrid = document.getElementById('videos-grid');
        const shortsGrid = document.getElementById('shorts-grid');
        const subscriptionsGrid = document.getElementById('subscriptions-grid');
        const historyGrid = document.getElementById('history-grid');
        const libraryContent = document.getElementById('library-content');
        const profileVideosContainer = document.getElementById('profile-videos-container');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const subscribeBtn = document.getElementById('subscribe-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        const shareBtn = document.getElementById('share-btn');
        const saveBtn = document.getElementById('save-btn');
        const categoryFilters = document.querySelectorAll('.category-filter');
        
        // Profile elements
        const userAvatar = document.getElementById('user-menu-btn');
        const profileDropdown = document.getElementById('profile-dropdown');
        const dropdownAvatar = document.getElementById('dropdown-avatar');
        const dropdownName = document.getElementById('dropdown-name');
        const dropdownVideos = document.getElementById('dropdown-videos');
        const dropdownViews = document.getElementById('dropdown-views');
        const dropdownSubscribers = document.getElementById('dropdown-subscribers');
        const viewProfileBtn = document.getElementById('view-profile-btn');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const editProfileFromPage = document.getElementById('edit-profile-from-page');
        const profileLargeAvatar = document.getElementById('profile-large-avatar');
        const profileDisplayName = document.getElementById('profile-display-name');
        const profileTotalVideos = document.getElementById('profile-total-videos');
        const profileTotalViews = document.getElementById('profile-total-views');
        const profileSubscribers = document.getElementById('profile-subscribers');
        const profileTabs = document.querySelectorAll('.profile-tab');
        
        // Search elements
        const searchVideosResults = document.getElementById('search-videos-results');
        const searchChannelsResults = document.getElementById('search-channels-results');
        const searchResultsTitle = document.getElementById('search-results-title');
        const searchTabs = document.querySelectorAll('.search-tab');
        
        // Authentication elements
        const authModal = document.getElementById('auth-modal');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const closeAuthModalBtn = document.getElementById('close-auth-modal');
        const authTabs = document.querySelectorAll('.auth-tab');
        
        // Modals
        const uploadModal = document.getElementById('upload-modal');
        const profileModal = document.getElementById('profile-modal');
        const thumbnailModal = document.getElementById('thumbnail-modal');
        const reportModal = document.getElementById('report-modal');
        const openUploadModalBtn = document.getElementById('open-upload-modal');
        const closeUploadModalBtn = document.getElementById('close-upload-modal');
        const closeProfileModalBtn = document.getElementById('close-profile-modal');
        const closeReportModalBtn = document.getElementById('close-report-modal');
        const cancelUploadBtn = document.getElementById('cancel-upload');
        const cancelProfileBtn = document.getElementById('cancel-profile');
        const cancelReportBtn = document.getElementById('cancel-report');
        const uploadForm = document.getElementById('upload-form');
        const profileForm = document.getElementById('profile-form');
        const videoFileInput = document.getElementById('video-file');
        const videoTitleInput = document.getElementById('video-title-input');
        const videoDescriptionInput = document.getElementById('video-description');
        const videoCategoryInput = document.getElementById('video-category');
        const videoThumbnailUpload = document.getElementById('video-thumbnail-upload');
        const profileNameInput = document.getElementById('profile-name-input');
        const avatarOptions = document.getElementById('avatar-options');
        const customAvatarInput = document.getElementById('custom-avatar');
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileNameDisplay = document.getElementById('file-name');
        const submitReportBtn = document.getElementById('submit-report');
        const reportDetails = document.getElementById('report-details');
        
        // Variables d'état
        let videoToEdit = null;
        let selectedThumbnailOption = null;
        let currentPlayingVideo = null;
        let customThumbnailFile = null;
        let customAvatarFile = null;
        let selectedAvatarOption = null;
        let videoWatchTimer = null;
        let currentVideoWatchStart = 0;
        let hasCountedView = false;
        let videoToReport = null;
        let commentToDelete = null;
        let currentSearchQuery = '';
        let currentVideoFile = null;
        
        // Initialiser l'interface
        async function init() {
            // Vérifier la session utilisateur
            await app.getCurrentSession();
            
            // Mettre à jour l'interface utilisateur
            updateUserInterface();
            
            // Afficher la section d'accueil
            showSection('home');
            
            // Charger les sections
            loadHomeVideos();
            loadShorts();
            loadLibraryContent();
            
            // Écouteurs d'événements
            setupEventListeners();
        }
        
        // Mettre à jour l'interface utilisateur
        function updateUserInterface() {
            const user = app.currentUser;
            
            if (user) {
                // Utilisateur connecté
                updateUserAvatar();
                updateProfileDropdown();
                
                // Activer le bouton d'upload
                openUploadModalBtn.disabled = false;
                openUploadModalBtn.style.opacity = '1';
                
                // Mettre à jour le header
                dropdownName.textContent = user.username;
                profileDisplayName.textContent = user.username;
            } else {
                // Utilisateur non connecté
                userAvatar.innerHTML = '<i class="fas fa-user"></i>';
                dropdownName.textContent = 'Non connecté';
                profileDisplayName.textContent = 'Non connecté';
                
                // Désactiver le bouton d'upload
                openUploadModalBtn.disabled = true;
                openUploadModalBtn.style.opacity = '0.5';
                
                // Afficher le modal d'authentification si on essaie d'uploader
                openUploadModalBtn.addEventListener('click', (e) => {
                    if (!app.currentUser) {
                        e.preventDefault();
                        openAuthModal();
                    }
                });
            }
        }
        
        // Afficher les résultats de recherche
        async function showSearchResults(query) {
            currentSearchQuery = query;
            searchResultsTitle.textContent = `Résultats pour "${query}"`;
            app.searchTab = 'videos';
            
            // Activer l'onglet vidéos
            searchTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector('.search-tab[data-search-tab="videos"]').classList.add('active');
            
            // Afficher les résultats de vidéos
            await showSearchVideosResults(query);
            
            // Cacher les résultats de chaînes
            searchChannelsResults.style.display = 'none';
            
            // Afficher la section de recherche
            showSection('search');
        }
        
        // Mettre à jour l'avatar utilisateur
        function updateUserAvatar() {
            const user = app.currentUser;
            if (!user) return;
            
            const avatarUrl = user.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}&backgroundColor=3ea6ff`;
            
            // Avatar dans le header
            userAvatar.innerHTML = `<img src="${avatarUrl}" alt="${user.username}" class="user-avatar-img">`;
            
            // Avatar dans le dropdown
            dropdownAvatar.innerHTML = `<img src="${avatarUrl}" alt="${user.username}" class="user-avatar-img">`;
            dropdownName.textContent = user.username;
            
            // Avatar dans les commentaires
            commentUserAvatar.innerHTML = `<img src="${avatarUrl}" alt="${user.username}" class="user-comment-avatar-img">`;
        }
        
        // Mettre à jour le dropdown du profil
        async function updateProfileDropdown() {
            const user = app.currentUser;
            if (!user) return;
            
            try {
                // Récupérer les statistiques de l'utilisateur
                const profile = await app.getUserProfile(user.id);
                const userVideos = await app.getUserVideos();
                
                dropdownVideos.textContent = userVideos.length;
                dropdownViews.textContent = userVideos.reduce((sum, video) => sum + video.views, 0);
                dropdownSubscribers.textContent = profile.subscribers || 0;
                dropdownName.textContent = user.username;
            } catch (error) {
                console.error('Erreur mise à jour dropdown:', error);
            }
        }
        
        // Charger les vidéos de la page d'accueil
        async function loadHomeVideos(category = 'all') {
            videosGrid.innerHTML = '';
            
            const videos = await app.getVideos(50, category);
            
            if (videos.length === 0) {
                videosGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
                        <i class="fas fa-video" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
                        <h3>Aucune vidéo disponible</h3>
                        <p>Soyez le premier à importer une vidéo !</p>
                    </div>
                `;
                return;
            }
            
            videos.forEach(video => {
                const videoElement = createVideoCard(video);
                videosGrid.appendChild(videoElement);
            });
        }
        
        // Charger les shorts
        async function loadShorts() {
            shortsGrid.innerHTML = '';
            
            const shorts = await app.getShorts(50);
            
            if (shorts.length === 0) {
                shortsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
                        <i class="fas fa-bolt" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
                        <h3>Aucun short disponible</h3>
                        <p>Importez une vidéo au format vertical pour créer un short !</p>
                    </div>
                `;
                return;
            }
            
            shorts.forEach(short => {
                const shortElement = document.createElement('div');
                shortElement.className = 'short-card';
                shortElement.dataset.id = short.id;
                shortElement.innerHTML = `
                    <div class="short-thumbnail">
                        <div class="short-badge">SHORT</div>
                        <img src="${short.thumbnail}" alt="${short.title}">
                    </div>
                    <div class="short-title">${short.title}</div>
                    <div class="short-views">${short.views} vues</div>
                `;
                
                shortElement.addEventListener('click', () => {
                    playVideo(short.id);
                });
                
                shortsGrid.appendChild(shortElement);
            });
        }
        
        // Charger les abonnements
        async function loadSubscriptions() {
            subscriptionsGrid.innerHTML = '';
            
            const subscribedChannels = await app.getSubscribedChannels();
            
            if (subscribedChannels.length === 0) {
                subscriptionsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
                        <i class="fas fa-user-friends" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
                        <h3>Aucun abonnement</h3>
                        <p>Abonnez-vous à des chaînes pour les voir apparaître ici</p>
                    </div>
                `;
                return;
            }
            
            subscribedChannels.forEach(channel => {
                const channelElement = document.createElement('div');
                channelElement.className = 'subscription-channel-card';
                channelElement.dataset.channelId = channel.id;
                channelElement.innerHTML = `
                    <div class="subscription-channel-avatar">
                        <img src="${channel.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${channel.username}&backgroundColor=3ea6ff`}" alt="${channel.username}" class="subscription-channel-avatar-img">
                    </div>
                    <div class="subscription-channel-name">${channel.username}</div>
                    <div class="subscription-channel-stats">${channel.subscribers} abonnés</div>
                `;
                
                channelElement.addEventListener('click', () => {
                    // Rechercher les vidéos de cette chaîne
                    searchInput.value = channel.username;
                    performSearch();
                });
                
                subscriptionsGrid.appendChild(channelElement);
            });
        }
        
        // Charger le profil utilisateur
        async function loadProfile() {
            const user = app.currentUser;
            if (!user) {
                profileDisplayName.textContent = 'Non connecté';
                return;
            }
            
            // Mettre à jour les informations du profil
            profileDisplayName.textContent = user.username;
            
            try {
                // Récupérer les vidéos de l'utilisateur
                const userVideos = await app.getUserVideos();
                const totalViews = userVideos.reduce((sum, video) => sum + video.views, 0);
                
                profileTotalVideos.textContent = userVideos.length;
                profileTotalViews.textContent = totalViews;
                profileSubscribers.textContent = user.subscribers || 0;
                
                // Mettre à jour l'avatar
                const avatarUrl = user.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}&backgroundColor=3ea6ff`;
                profileLargeAvatar.innerHTML = `<img src="${avatarUrl}" alt="${user.username}" class="profile-avatar-large-img">`;
                
                // Charger les vidéos du profil
                loadProfileVideos();
            } catch (error) {
                console.error('Erreur chargement profil:', error);
            }
        }
        
        // Charger les vidéos du profil
        async function loadProfileVideos() {
            profileVideosContainer.innerHTML = '';
            
            const userVideos = await app.getUserVideos();
            const filteredVideos = app.profileTab === 'shorts' 
                ? userVideos.filter(v => v.isShort)
                : userVideos.filter(v => !v.isShort);
            
            if (filteredVideos.length === 0) {
                profileVideosContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
                        <i class="fas fa-video" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
                        <h3>Aucune ${app.profileTab === 'videos' ? 'vidéo' : 'short'} publiée</h3>
                        <p>Importez votre première ${app.profileTab === 'videos' ? 'vidéo' : 'short'} pour commencer !</p>
                    </div>
                `;
                return;
            }
            
            filteredVideos.forEach(video => {
                const videoElement = createVideoCard(video, true);
                profileVideosContainer.appendChild(videoElement);
            });
        }
        
        // Charger le contenu de la bibliothèque
        async function loadLibraryContent() {
            libraryContent.innerHTML = '';
            
            if (app.libraryTab === 'my-videos') {
                if (!app.currentUser) {
                    libraryContent.innerHTML = `
                        <div class="empty-library">
                            <i class="fas fa-user"></i>
                            <h3>Connectez-vous</h3>
                            <p>Connectez-vous pour voir vos vidéos</p>
                            <button class="login-btn" style="margin-top: 16px;" id="login-from-library">Se connecter</button>
                        </div>
                    `;
                    
                    document.getElementById('login-from-library')?.addEventListener('click', openAuthModal);
                    return;
                }
                
                const userVideos = await app.getUserVideos();
                
                if (userVideos.length === 0) {
                    libraryContent.innerHTML = `
                        <div class="empty-library">
                            <i class="fas fa-video"></i>
                            <h3>Aucune vidéo publiée</h3>
                            <p>Les vidéos que vous importez apparaîtront ici</p>
                            <button class="upload-btn" style="margin-top: 16px;" id="import-from-library">Importer une vidéo</button>
                        </div>
                    `;
                    
                    document.getElementById('import-from-library')?.addEventListener('click', () => {
                        openUploadModal();
                    });
                } else {
                    const videosContainer = document.createElement('div');
                    videosContainer.className = 'videos-grid';
                    
                    userVideos.forEach(video => {
                        const videoElement = createVideoCard(video, true);
                        videosContainer.appendChild(videoElement);
                    });
                    
                    libraryContent.appendChild(videosContainer);
                }
            } else if (app.libraryTab === 'liked-videos') {
                const allVideos = await app.getVideos(100);
                const likedVideos = allVideos.filter(v => app.isLiked(v.id));
                
                if (likedVideos.length === 0) {
                    libraryContent.innerHTML = `
                        <div class="empty-library">
                            <i class="fas fa-thumbs-up"></i>
                            <h3>Aucune vidéo aimée</h3>
                            <p>Les vidéos que vous aimez apparaîtront ici</p>
                        </div>
                    `;
                } else {
                    const videosContainer = document.createElement('div');
                    videosContainer.className = 'videos-grid';
                    // ... (suite du code après la partie "likedVideos")

likedVideos.forEach(video => {
    const videoElement = createVideoCard(video);
    videosContainer.appendChild(videoElement);
});

libraryContent.appendChild(videosContainer);
}
} else if (app.libraryTab === 'playlists') {
libraryContent.innerHTML = `
<div class="empty-library">
    <i class="fas fa-list"></i>
    <h3>Aucune playlist</h3>
    <p>Créez des playlists pour organiser vos vidéos favorites</p>
</div>
`;
}
}

// Charger l'historique
async function loadHistory() {
historyGrid.innerHTML = '';

if (app.watchHistory.length === 0) {
    historyGrid.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
            <i class="fas fa-history" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
            <h3>Aucun historique</h3>
            <p>Les vidéos que vous regardez apparaîtront ici</p>
        </div>
    `;
    return;
}

// Récupérer les vidéos de l'historique
const videosPromises = app.watchHistory.map(videoId => app.getVideoById(videoId));
const videos = (await Promise.all(videosPromises)).filter(v => v !== null);

if (videos.length === 0) {
    historyGrid.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
            <i class="fas fa-history" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
            <h3>Aucun historique</h3>
            <p>Les vidéos que vous regardez apparaîtront ici</p>
        </div>
    `;
    return;
}

videos.forEach(video => {
    const videoElement = createVideoCard(video);
    historyGrid.appendChild(videoElement);
});
}

// Créer une carte vidéo avec actions conditionnelles
function createVideoCard(video, showActions = false) {
const videoElement = document.createElement('div');
videoElement.className = 'video-card';
videoElement.dataset.id = video.id;

// Vérifier si l'utilisateur peut gérer cette vidéo
const isUserVideo = app.currentUser && video.channelId === app.currentUser.id;
const canManage = isUserVideo;

let actionsMenu = '';
if (showActions || canManage) {
    actionsMenu = `
        <div class="video-actions-menu" data-video-id="${video.id}">
            <i class="fas fa-ellipsis-v"></i>
            <div class="video-actions-dropdown" id="dropdown-${video.id}">
                ${isUserVideo ? `
                    <div class="dropdown-item" data-action="edit">
                        <i class="fas fa-edit"></i>
                        <span>Modifier</span>
                    </div>
                    <div class="dropdown-item" data-action="edit-thumbnail">
                        <i class="fas fa-image"></i>
                        <span>Changer la miniature</span>
                    </div>
                ` : ''}
                ${canManage ? `
                    <div class="dropdown-item" data-action="delete">
                        <i class="fas fa-trash"></i>
                        <span>Supprimer</span>
                    </div>
                ` : ''}
                ${!isUserVideo ? `
                    <div class="dropdown-item" data-action="report">
                        <i class="fas fa-flag"></i>
                        <span>Signaler</span>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Ajouter un indicateur de format
const formatIndicator = video.isShort ? `<div class="format-indicator">${video.aspectRatio}</div>` : '';

videoElement.innerHTML = `
    <div class="video-thumbnail-container">
        <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail">
        <div class="video-duration">${video.duration}</div>
        ${formatIndicator}
        ${actionsMenu}
    </div>
    <div class="video-info">
        <div class="channel-avatar">
            <img src="${video.channelAvatar}" alt="${video.channel}" class="channel-avatar-img">
        </div>
        <div class="video-details">
            <h3>${video.title}</h3>
            <p>${video.channel}</p>
            <p>${video.views} vues • ${video.date}</p>
        </div>
    </div>
`;

videoElement.addEventListener('click', (e) => {
    if (!e.target.closest('.video-actions-menu')) {
        playVideo(video.id);
    }
});

if (actionsMenu) {
    const actionsMenuElement = videoElement.querySelector('.video-actions-menu');
    const dropdown = videoElement.querySelector('.video-actions-dropdown');
    
    actionsMenuElement.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdown.classList.toggle('show');
    });
    
    dropdown.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.stopPropagation();
            const action = item.dataset.action;
            handleVideoAction(video.id, action);
            dropdown.classList.remove('show');
        });
    });
    
    document.addEventListener('click', () => {
        dropdown.classList.remove('show');
    });
}

return videoElement;
}

// Réinitialiser le suivi vidéo
function resetVideoTracking() {
if (videoWatchTimer) {
    clearTimeout(videoWatchTimer);
    videoWatchTimer = null;
}
hasCountedView = false;
currentVideoWatchStart = 0;
}

// Démarrer le suivi du visionnage
function startVideoTracking(videoId) {
resetVideoTracking();

// Commencer à compter après 30 secondes
videoWatchTimer = setTimeout(() => {
    // Incrémenter les vues dans la base de données
    app.incrementViews(videoId);
    hasCountedView = true;
    
    // Mettre à jour l'affichage
    const video = app.getVideoById(videoId);
    if (video) {
        videoViews.textContent = `${video.views + 1} vues • ${video.date}`;
    }
    
    // Continuer à vérifier toutes les 30 secondes
    videoWatchTimer = setInterval(() => {
        if (mainVideo && !mainVideo.paused) {
            app.incrementViews(videoId);
            
            // Mettre à jour l'affichage
            const video = app.getVideoById(videoId);
            if (video) {
                videoViews.textContent = `${video.views + 1} vues • ${video.date}`;
            }
        }
    }, 30000); // 30 secondes
}, 30000);

currentVideoWatchStart = Date.now();
}

// Jouer une vidéo
async function playVideo(videoId) {
const video = await app.getVideoById(videoId);
if (!video) return;

// Arrêter la vidéo en cours
if (currentPlayingVideo) {
    currentPlayingVideo.pause();
    resetVideoTracking();
}

// Ajouter à l'historique
app.addToHistory(videoId);

// Charger la vidéo
videoSource.src = video.videoUrl;
mainVideo.load();
mainVideo.poster = video.thumbnail;

// Mettre à jour les informations
videoTitle.textContent = video.title;
videoViews.textContent = `${video.views} vues • ${video.date}`;
likeCount.textContent = video.likes;
commentsCount.textContent = `${video.comments} commentaire${video.comments !== 1 ? 's' : ''}`;

// Mettre à jour les informations de la chaîne
document.getElementById('channel-avatar').innerHTML = `<img src="${video.channelAvatar}" alt="${video.channel}" class="channel-avatar-img">`;
document.getElementById('channel-name').textContent = video.channel;
document.getElementById('subscriber-count').textContent = `${video.subscribers} abonnés`;

// Mettre à jour le bouton d'abonnement
const isSubscribed = await app.isSubscribed(video.channelId);
subscribeBtn.textContent = isSubscribed ? "Abonné" : "S'abonner";
subscribeBtn.classList.toggle('subscribed', isSubscribed);
subscribeBtn.dataset.channelId = video.channelId;

// Mettre à jour le bouton de like
const isLiked = app.isLiked(video.id);
likeCount.style.color = isLiked ? '#3ea6ff' : 'inherit';

// Mettre à jour le bouton de sauvegarde
const isSaved = app.isSaved(video.id);
saveBtn.querySelector('span').textContent = isSaved ? "Sauvegardé" : "Sauvegarder";
saveBtn.dataset.videoId = video.id;

// Charger les commentaires
loadComments(videoId);

// Charger les vidéos recommandées
loadRecommendedVideos(videoId);

// Afficher la section du lecteur
app.currentVideoId = videoId;
showSection('player');

// Démarrer le suivi du visionnage
startVideoTracking(videoId);

// Stocker la référence à la vidéo en cours
currentPlayingVideo = mainVideo;

// Écouter la fin de la vidéo
mainVideo.onended = () => {
    resetVideoTracking();
};

// Écouter la pause de la vidéo
mainVideo.onpause = () => {
    if (videoWatchTimer) {
        clearTimeout(videoWatchTimer);
        videoWatchTimer = null;
    }
};

// Écouter la reprise de la vidéo
mainVideo.onplay = () => {
    if (!videoWatchTimer && !hasCountedView) {
        startVideoTracking(videoId);
    }
};
}

// Charger les commentaires avec actions de suppression
async function loadComments(videoId) {
commentList.innerHTML = '';
const comments = await app.getCommentsForVideo(videoId);

if (comments.length === 0) {
    commentList.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: #aaa;">
            <p>Soyez le premier à commenter cette vidéo !</p>
        </div>
    `;
    return;
}

comments.forEach(comment => {
    const commentElement = document.createElement('div');
    commentElement.className = 'comment-item';
    commentElement.dataset.commentId = comment.id;
    
    // Ajouter des boutons d'action si l'utilisateur peut supprimer le commentaire
    const actions = comment.canDelete ? `
        <div class="comment-actions">
            <button class="comment-action-btn delete-comment-btn" data-comment-id="${comment.id}">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        </div>
    ` : '';
    
    commentElement.innerHTML = `
        <div class="user-comment-avatar">
            <img src="${comment.authorAvatar}" alt="${comment.author}" class="user-comment-avatar-img">
        </div>
        <div class="comment-text">
            <div class="comment-author">${comment.author} <span style="color: #aaa; font-weight: normal; font-size: 12px;">${comment.time}</span></div>
            <div class="comment-content">${comment.content}</div>
            ${actions}
        </div>
    `;
    
    commentList.appendChild(commentElement);
});

// Ajouter des écouteurs d'événements pour les boutons de suppression de commentaires
document.querySelectorAll('.delete-comment-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const commentId = btn.dataset.commentId;
        deleteComment(commentId);
    });
});
}

// Charger les vidéos recommandées
async function loadRecommendedVideos(currentVideoId) {
recommendedVideosContainer.innerHTML = '';

// Récupérer des vidéos de la même catégorie
const currentVideo = await app.getVideoById(currentVideoId);
if (!currentVideo) return;

const allVideos = await app.getVideos(20);
const recommendedVideos = allVideos.filter(v => 
    v.id != currentVideoId && 
    (v.category === currentVideo.category || v.channel === currentVideo.channel)
).slice(0, 5);

if (recommendedVideos.length === 0) {
    recommendedVideosContainer.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #aaa;">
            <p>Aucune autre vidéo disponible</p>
        </div>
    `;
    return;
}

recommendedVideos.forEach(video => {
    const videoElement = document.createElement('div');
    videoElement.className = 'recommended-video';
    videoElement.dataset.id = video.id;
    videoElement.innerHTML = `
        <div class="recommended-thumbnail">
            <img src="${video.thumbnail}" alt="${video.title}">
        </div>
        <div class="recommended-info">
            <div class="recommended-video-title">${video.title}</div>
            <div class="recommended-channel">${video.channel}</div>
            <div class="recommended-stats">${video.views} vues</div>
        </div>
    `;
    
    videoElement.addEventListener('click', () => {
        playVideo(video.id);
    });
    
    recommendedVideosContainer.appendChild(videoElement);
});
}

// Afficher les résultats de recherche de vidéos
async function showSearchVideosResults(query) {
searchVideosResults.innerHTML = '';

const videos = await app.searchVideos(query);

if (videos.length === 0) {
    searchVideosResults.innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: #aaa;">
            <i class="fas fa-search" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
            <h3>Aucune vidéo trouvée</h3>
            <p>Aucune vidéo ne correspond à votre recherche</p>
        </div>
    `;
    return;
}

const videosContainer = document.createElement('div');
videosContainer.className = 'videos-grid';

videos.forEach(video => {
    const videoElement = createVideoCard(video);
    videosContainer.appendChild(videoElement);
});

searchVideosResults.appendChild(videosContainer);
}

// Afficher les résultats de recherche de chaînes
async function showSearchChannelsResults(query) {
searchChannelsResults.innerHTML = '';

const channels = await app.searchChannels(query);

if (channels.length === 0) {
    searchChannelsResults.innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: #aaa;">
            <i class="fas fa-users" style="font-size: 64px; margin-bottom: 16px; color: #3f3f3f;"></i>
            <h3>Aucune chaîne trouvée</h3>
            <p>Aucune chaîne ne correspond à votre recherche</p>
        </div>
    `;
    return;
}

const channelsContainer = document.createElement('div');
channelsContainer.className = 'subscriptions-grid';

channels.forEach(channel => {
    const channelElement = document.createElement('div');
    channelElement.className = 'subscription-channel-card';
    channelElement.dataset.channelId = channel.id;
    channelElement.innerHTML = `
        <div class="subscription-channel-avatar">
            <img src="${channel.avatar}" alt="${channel.username}" class="subscription-channel-avatar-img">
        </div>
        <div class="subscription-channel-name">${channel.username}</div>
        <div class="subscription-channel-stats">${channel.subscribers} abonnés</div>
        <div class="subscription-channel-description" style="font-size: 12px; color: #aaa; margin-top: 8px;">${channel.description}</div>
    `;
    
    channelElement.addEventListener('click', () => {
        // Rechercher les vidéos de cette chaîne
        searchInput.value = channel.username;
        performSearch();
    });
    
    channelsContainer.appendChild(channelElement);
});

searchChannelsResults.appendChild(channelsContainer);
}

// Gérer les actions sur les vidéos
async function handleVideoAction(videoId, action) {
switch (action) {
    case 'edit':
        await editVideo(videoId);
        break;
    case 'edit-thumbnail':
        editThumbnail(videoId);
        break;
    case 'delete':
        await deleteVideo(videoId);
        break;
    case 'report':
        reportVideo(videoId);
        break;
}
}

// Modifier une vidéo
async function editVideo(videoId) {
const video = await app.getVideoById(videoId);
if (!video) return;

// Vérifier que l'utilisateur est propriétaire
if (!app.currentUser || video.channelId !== app.currentUser.id) {
    alert("Vous ne pouvez modifier que vos propres vidéos.");
    return;
}

videoToEdit = videoId;
videoTitleInput.value = video.title;
videoDescriptionInput.value = video.description || '';
videoCategoryInput.value = video.category;

openUploadModal();
}

// Modifier la miniature
function editThumbnail(videoId) {
videoToEdit = videoId;
openThumbnailModal();
}

// Supprimer une vidéo
async function deleteVideo(videoId) {
const video = await app.getVideoById(videoId);
if (!video) return;

const isUserVideo = app.currentUser && video.channelId === app.currentUser.id;
const message = isUserVideo 
    ? "Voulez-vous vraiment supprimer cette vidéo ? Cette action est irréversible."
    : `Voulez-vous vraiment supprimer la vidéo "${video.title}" de ${video.channel} ? Cette action est irréversible.`;

if (confirm(message)) {
    const result = await app.deleteVideo(videoId);
    
    if (result.success) {
        // Recharger les sections concernées
        if (app.currentSection === 'home') {
            loadHomeVideos();
        }
        if (app.currentSection === 'shorts') {
            loadShorts();
        }
        if (app.libraryTab === 'my-videos') {
            loadLibraryContent();
        }
        if (app.currentSection === 'profile') {
            loadProfile();
        }
        
        if (app.currentVideoId === videoId) {
            showSection('home');
        }
        
        // Mettre à jour le dropdown du profil
        updateProfileDropdown();
        
        alert("Vidéo supprimée avec succès !");
    } else {
        alert(`Erreur: ${result.error}`);
    }
}
}

// Signaler une vidéo
function reportVideo(videoId) {
videoToReport = videoId;
openReportModal();
}

// Supprimer un commentaire
async function deleteComment(commentId) {
if (confirm("Voulez-vous vraiment supprimer ce commentaire ?")) {
    const result = await app.deleteComment(commentId);
    
    if (result.success) {
        // Recharger les commentaires
        loadComments(app.currentVideoId);
        
        // Mettre à jour le compteur
        const video = await app.getVideoById(app.currentVideoId);
        if (video) {
            commentsCount.textContent = `${video.comments} commentaire${video.comments !== 1 ? 's' : ''}`;
        }
        
        alert("Commentaire supprimé avec succès !");
    } else {
        alert(`Erreur: ${result.error}`);
    }
}
}

// Afficher une section spécifique
function showSection(sectionId) {
// Arrêter la vidéo en cours si on quitte le lecteur
if (sectionId !== 'player' && currentPlayingVideo) {
    currentPlayingVideo.pause();
    resetVideoTracking();
    currentPlayingVideo = null;
}

// Cacher toutes les sections
document.querySelectorAll('.content-section').forEach(section => {
    section.classList.remove('active');
});

// Désactiver tous les éléments de la sidebar
document.querySelectorAll('.sidebar-item').forEach(item => {
    item.classList.remove('active');
});

// Afficher la section demandée
const sectionElement = document.getElementById(`${sectionId}-section`);
if (sectionElement) {
    sectionElement.classList.add('active');
    
    // Activer l'élément correspondant dans la sidebar
    const sidebarItem = document.querySelector(`.sidebar-item[data-section="${sectionId}"]`);
    if (sidebarItem) {
        sidebarItem.classList.add('active');
    }
}

// Mettre à jour l'état de l'application
app.currentSection = sectionId;

// Charger des données spécifiques pour certaines sections
if (sectionId === 'subscriptions') {
    loadSubscriptions();
} else if (sectionId === 'profile') {
    loadProfile();
} else if (sectionId === 'history') {
    loadHistory();
}
}

// Ouvrir le modal d'upload
function openUploadModal() {
if (!app.currentUser) {
    openAuthModal();
    return;
}

uploadModal.style.display = 'flex';
customThumbnailFile = null;
currentVideoFile = null;
fileNameDisplay.textContent = '';
videoTitleInput.value = '';
videoDescriptionInput.value = '';
videoCategoryInput.value = 'general';
videoThumbnailUpload.value = '';
videoToEdit = null;
}

// Fermer le modal d'upload
function closeUploadModal() {
uploadModal.style.display = 'none';
uploadForm.reset();
fileNameDisplay.textContent = '';
videoToEdit = null;
customThumbnailFile = null;
currentVideoFile = null;
}

// Ouvrir le modal d'authentification
function openAuthModal() {
authModal.style.display = 'flex';
}

// Fermer le modal d'authentification
function closeAuthModal() {
authModal.style.display = 'none';
loginForm.reset();
signupForm.reset();
}

// Ouvrir le modal de profil
function openProfileModal() {
if (!app.currentUser) {
    openAuthModal();
    return;
}

const profile = app.currentUser;
profileNameInput.value = profile.username;

// Charger les options d'avatar
loadAvatarOptions();

profileModal.style.display = 'flex';
}

// Fermer le modal de profil
function closeProfileModal() {
profileModal.style.display = 'none';
profileForm.reset();
selectedAvatarOption = null;
customAvatarFile = null;
}

// Ouvrir le modal de signalement
function openReportModal() {
// Réinitialiser le formulaire
document.querySelectorAll('input[name="report-reason"]').forEach(radio => {
    radio.checked = false;
});
reportDetails.value = '';

reportModal.style.display = 'flex';
}

// Fermer le modal de signalement
function closeReportModal() {
reportModal.style.display = 'none';
videoToReport = null;
}

// Charger les options d'avatar
function loadAvatarOptions() {
avatarOptions.innerHTML = '';

// Avatars par défaut (générés avec DiceBear)
const defaultAvatars = [
    { id: 'avatar1', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex&backgroundColor=3ea6ff' },
    { id: 'avatar2', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jordan&backgroundColor=ff6b6b' },
    { id: 'avatar3', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Taylor&backgroundColor=51cf66' },
    { id: 'avatar4', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Casey&backgroundColor=fcc419' },
    { id: 'avatar5', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Riley&backgroundColor=cc5de8' },
    { id: 'avatar6', url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Skyler&backgroundColor=339af0' }
];

defaultAvatars.forEach(avatar => {
    const option = document.createElement('div');
    option.className = 'avatar-option';
    if (app.currentUser && avatar.url === app.currentUser.avatar) {
        option.classList.add('selected');
        selectedAvatarOption = avatar;
    }
    option.dataset.avatar = avatar.id;
    option.innerHTML = `<img src="${avatar.url}" alt="Avatar">`;
    
    option.addEventListener('click', () => {
        document.querySelectorAll('.avatar-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        option.classList.add('selected');
        selectedAvatarOption = avatar;
        customAvatarFile = null;
    });
    
    avatarOptions.appendChild(option);
});

// Option pour uploader un avatar personnalisé
const uploadOption = document.createElement('div');
uploadOption.className = 'avatar-option avatar-upload';
uploadOption.innerHTML = `<i class="fas fa-plus"></i>`;
uploadOption.title = "Uploader un avatar personnalisé";

uploadOption.addEventListener('click', () => {
    customAvatarInput.click();
});

avatarOptions.appendChild(uploadOption);
}

// Ouvrir le modal de miniature
function openThumbnailModal() {
const selector = document.getElementById('thumbnail-selector');
selector.innerHTML = '';

// Miniatures par défaut pour tous types de vidéos
const defaultThumbnails = [
    { id: 'default1', url: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Nature' },
    { id: 'default2', url: 'https://images.unsplash.com/photo-1627398242454-45a1465c2479?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Technologie' },
    { id: 'default3', url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Montagne' },
    { id: 'default4', url: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Gaming' },
    { id: 'default5', url: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Musique' },
    { id: 'default6', url: 'https://images.unsplash.com/photo-1563379926898-05f4575a45d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', label: 'Cuisine' }
];

defaultThumbnails.forEach(thumb => {
    const option = document.createElement('div');
    option.className = 'thumbnail-option';
    option.dataset.thumbnail = thumb.id;
    option.innerHTML = `<img src="${thumb.url}" alt="${thumb.label}">`;
    
    option.addEventListener('click', () => {
        document.querySelectorAll('.thumbnail-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        option.classList.add('selected');
        selectedThumbnailOption = thumb;
    });
    
    selector.appendChild(option);
});

thumbnailModal.style.display = 'flex';
}

// Fermer le modal de miniature
function closeThumbnailModal() {
thumbnailModal.style.display = 'none';
videoToEdit = null;
selectedThumbnailOption = null;
document.getElementById('new-thumbnail').value = '';
}

// Détecter le format d'une vidéo
function detectVideoFormat(file) {
return new Promise((resolve) => {
    const video = document.createElement('video');
    video.preload = 'metadata';
    
    video.onloadedmetadata = function() {
        const width = video.videoWidth;
        const height = video.videoHeight;
        const ratio = width / height;
        
        let aspectRatio;
        
        // Déterminer le ratio d'aspect
        if (Math.abs(ratio - 9/16) < 0.1) aspectRatio = "9:16";
        else if (Math.abs(ratio - 1) < 0.1) aspectRatio = "1:1";
        else if (Math.abs(ratio - 4/5) < 0.1) aspectRatio = "4:5";
        else if (Math.abs(ratio - 4/3) < 0.1) aspectRatio = "4:3";
        else if (Math.abs(ratio - 2/3) < 0.1) aspectRatio = "2:3";
        else if (Math.abs(ratio - 16/9) < 0.1) aspectRatio = "16:9";
        else aspectRatio = "other";
        
        // Formater la durée
        const duration = Math.round(video.duration);
        const minutes = Math.floor(duration / 60);
        const seconds = duration % 60;
        const durationStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        resolve({
            aspectRatio: aspectRatio,
            duration: durationStr,
            width: width,
            height: height,
            isShort: ["9:16", "1:1", "4:5", "4:3", "2:3"].includes(aspectRatio)
        });
        
        // Nettoyer l'URL
        URL.revokeObjectURL(video.src);
    };
    
    video.onerror = function() {
        resolve({
            aspectRatio: "16:9",
            duration: "5:30",
            width: 1920,
            height: 1080,
            isShort: false
        });
    };
    
    video.src = URL.createObjectURL(file);
});
}

// Lire un fichier comme URL de données
function readFileAsDataURL(file) {
return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
});
}

// Configurer les écouteurs d'événements
function setupEventListeners() {
// Navigation dans la sidebar
document.querySelectorAll('.sidebar-item').forEach(item => {
    item.addEventListener('click', () => {
        const section = item.dataset.section;
        showSection(section);
    });
});

// Onglets du profil
profileTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        profileTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        app.profileTab = tab.dataset.profileTab;
        loadProfileVideos();
    });
});

// Filtres de catégorie
categoryFilters.forEach(filter => {
    filter.addEventListener('click', () => {
        categoryFilters.forEach(f => f.classList.remove('active'));
        filter.classList.add('active');
        
        const category = filter.dataset.category;
        loadHomeVideos(category);
    });
});

// Navigation dans la bibliothèque
document.querySelectorAll('.library-action-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.library-action-btn').forEach(b => {
            b.classList.remove('active');
        });
        btn.classList.add('active');
        
        app.libraryTab = btn.dataset.libraryTab;
        loadLibraryContent();
    });
});

// Onglets de recherche
searchTabs.forEach(tab => {
    tab.addEventListener('click', async () => {
        searchTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        app.searchTab = tab.dataset.searchTab;
        
        if (app.searchTab === 'videos') {
            searchVideosResults.style.display = 'block';
            searchChannelsResults.style.display = 'none';
            await showSearchVideosResults(currentSearchQuery);
        } else {
            searchVideosResults.style.display = 'none';
            searchChannelsResults.style.display = 'block';
            await showSearchChannelsResults(currentSearchQuery);
        }
    });
});

// Recherche
searchButton.addEventListener('click', performSearch);
searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        performSearch();
    }
});

// Commentaires
commentSubmitBtn.addEventListener('click', async () => {
    if (!app.currentVideoId || !app.currentUser) {
        openAuthModal();
        return;
    }
    
    const content = commentInput.value.trim();
    if (content) {
        const comment = await app.addComment(app.currentVideoId, content);
        if (comment) {
            loadComments(app.currentVideoId);
            
            const video = await app.getVideoById(app.currentVideoId);
            if (video) {
                commentsCount.textContent = `${video.comments} commentaire${video.comments !== 1 ? 's' : ''}`;
            }
            
            commentInput.value = '';
        }
    }
});

// Likes
document.getElementById('like-btn').addEventListener('click', async () => {
    if (!app.currentVideoId) return;
    
    if (!app.currentUser) {
        openAuthModal();
        return;
    }
    
    const liked = app.toggleLike(app.currentVideoId);
    const video = await app.getVideoById(app.currentVideoId);
    if (video) {
        likeCount.textContent = liked ? video.likes + 1 : video.likes;
        likeCount.style.color = liked ? '#3ea6ff' : 'inherit';
    }
});

// Dislikes
dislikeBtn.addEventListener('click', () => {
    if (!app.currentVideoId) return;
    
    alert("Merci pour votre retour !");
});

// Partager
shareBtn.addEventListener('click', () => {
    if (!app.currentVideoId) return;
    
    const shareUrl = window.location.href.split('#')[0] + '#video=' + app.currentVideoId;
    navigator.clipboard.writeText(shareUrl).then(() => {
        alert("Lien de la vidéo copié dans le presse-papier !");
    });
});

// Sauvegarder
saveBtn.addEventListener('click', async () => {
    if (!app.currentVideoId) return;
    
    if (!app.currentUser) {
        openAuthModal();
        return;
    }
    
    const saved = app.toggleSave(app.currentVideoId);
    saveBtn.querySelector('span').textContent = saved ? "Sauvegardé" : "Sauvegarder";
    alert(saved ? "Vidéo sauvegardée !" : "Vidéo retirée des sauvegardes");
});

// S'abonner
subscribeBtn.addEventListener('click', async () => {
    if (!app.currentVideoId) return;
    
    if (!app.currentUser) {
        openAuthModal();
        return;
    }
    
    const channelId = subscribeBtn.dataset.channelId;
    if (!channelId) return;
    
    const result = await app.toggleSubscription(channelId);
    
    if (result.success) {
        const video = await app.getVideoById(app.currentVideoId);
        if (video) {
            if (result.subscribed) {
                video.subscribers = (parseInt(video.subscribers) + 1).toString();
                document.getElementById('subscriber-count').textContent = `${video.subscribers} abonnés`;
            } else {
                video.subscribers = (parseInt(video.subscribers) - 1).toString();
                document.getElementById('subscriber-count').textContent = `${video.subscribers} abonnés`;
            }
        }
        
        subscribeBtn.textContent = result.subscribed ? "Abonné" : "S'abonner";
        subscribeBtn.classList.toggle('subscribed', result.subscribed);
        
        // Recharger les abonnements si on est dans la section abonnements
        if (app.currentSection === 'subscriptions') {
            loadSubscriptions();
        }
    }
});

// Menu utilisateur
userAvatar.addEventListener('click', (e) => {
    e.stopPropagation();
    profileDropdown.classList.toggle('show');
});

// Voir le profil
viewProfileBtn.addEventListener('click', () => {
    profileDropdown.classList.remove('show');
    loadProfile();
    showSection('profile');
});

// Modifier le profil (depuis le dropdown)
editProfileBtn.addEventListener('click', () => {
    profileDropdown.classList.remove('show');
    openProfileModal();
});

// Modifier le profil (depuis la page profil)
editProfileFromPage.addEventListener('click', () => {
    openProfileModal();
});

// Déconnexion
document.getElementById('logout-btn').addEventListener('click', async () => {
    profileDropdown.classList.remove('show');
    const result = await app.signOut();
    if (result.success) {
        updateUserInterface();
        showSection('home');
        alert("Déconnexion effectuée !");
    }
});

// Fermer les dropdowns en cliquant ailleurs
document.addEventListener('click', () => {
    profileDropdown.classList.remove('show');
});

// Onglets d'authentification
authTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        authTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        const authTab = tab.dataset.authTab;
        document.querySelectorAll('.auth-form').forEach(form => {
            form.classList.remove('active');
        });
        document.getElementById(`${authTab}-form`).classList.add('active');
    });
});

// Connexion
loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    const result = await app.signIn(email, password);
    
    if (result.success) {
        updateUserInterface();
        closeAuthModal();
        alert(`Bienvenue ${result.user.username} !`);
        
        // Recharger les données
        loadHomeVideos();
        loadShorts();
        loadLibraryContent();
    } else {
        alert(`Erreur de connexion: ${result.error}`);
    }
});

// Inscription
signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('signup-username').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    
    const result = await app.signUp(email, password, username);
    
    if (result.success) {
        updateUserInterface();
        closeAuthModal();
        alert(`Compte créé avec succès ! Bienvenue ${username} !`);
        
        // Recharger les données
        loadHomeVideos();
        loadShorts();
        loadLibraryContent();
    } else {
        alert(`Erreur d'inscription: ${result.error}`);
    }
});

// Upload modal
openUploadModalBtn.addEventListener('click', openUploadModal);
closeUploadModalBtn.addEventListener('click', closeUploadModal);
closeAuthModalBtn.addEventListener('click', closeAuthModal);
cancelUploadBtn.addEventListener('click', closeUploadModal);

// Gestion de l'upload de fichier vidéo
fileUploadArea.addEventListener('click', () => {
    videoFileInput.click();
});

videoFileInput.addEventListener('change', async () => {
    if (videoFileInput.files.length > 0) {
        const file = videoFileInput.files[0];
        currentVideoFile = file;
        fileNameDisplay.textContent = `Fichier sélectionné : ${file.name}`;
        
        // Détecter le format de la vidéo
        const videoInfo = await detectVideoFormat(file);
        
        if (videoInfo.isShort) {
            fileNameDisplay.textContent += ` (SHORT - ${videoInfo.aspectRatio})`;
        } else {
            fileNameDisplay.textContent += ` (VIDÉO - ${videoInfo.aspectRatio})`;
        }
    }
});

// Upload de miniature lors de l'import
videoThumbnailUpload.addEventListener('change', async () => {
    if (videoThumbnailUpload.files.length > 0) {
        customThumbnailFile = videoThumbnailUpload.files[0];
        fileNameDisplay.textContent += ` + Miniature personnalisée`;
    }
});

// Upload d'avatar personnalisé
customAvatarInput.addEventListener('change', async () => {
    if (customAvatarInput.files.length > 0) {
        customAvatarFile = customAvatarInput.files[0];
        selectedAvatarOption = null;
        
        // Désélectionner tous les avatars par défaut
        document.querySelectorAll('.avatar-option').forEach(opt => {
            opt.classList.remove('selected');
        });
    }
});

// Glisser-déposer de fichier
fileUploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    fileUploadArea.style.borderColor = '#3ea6ff';
});

fileUploadArea.addEventListener('dragleave', () => {
    fileUploadArea.style.borderColor = '#3f3f3f';
});

fileUploadArea.addEventListener('drop', async (e) => {
    e.preventDefault();
    fileUploadArea.style.borderColor = '#3f3f3f';
    
    if (e.dataTransfer.files.length > 0) {
        videoFileInput.files = e.dataTransfer.files;
        const file = e.dataTransfer.files[0];
        currentVideoFile = file;
        fileNameDisplay.textContent = `Fichier sélectionné : ${file.name}`;
        
        // Détecter le format de la vidéo
        const videoInfo = await detectVideoFormat(file);
        
        if (videoInfo.isShort) {
            fileNameDisplay.textContent += ` (SHORT - ${videoInfo.aspectRatio})`;
        } else {
            fileNameDisplay.textContent += ` (VIDÉO - ${videoInfo.aspectRatio})`;
        }
    }
});

// Formulaire d'upload
uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!app.currentUser) {
        openAuthModal();
        return;
    }
    
    const title = videoTitleInput.value;
    const description = videoDescriptionInput.value;
    const category = videoCategoryInput.value;
    
    if (!currentVideoFile && !videoToEdit) {
        alert("Veuillez sélectionner une vidéo à importer");
        return;
    }
    
    let thumbnailFile = customThumbnailFile;
    
    if (!videoToEdit) {
        // NOUVELLE VIDÉO
        let videoInfo = {
            aspectRatio: "16:9",
            duration: "5:30",
            isShort: false
        };
        
        if (currentVideoFile) {
            videoInfo = await detectVideoFormat(currentVideoFile);
        }
        
        // Ajouter la nouvelle vidéo
        const result = await app.addVideo({
            title: title,
            description: description,
            videoFile: currentVideoFile,
            thumbnailFile: thumbnailFile,
            aspectRatio: videoInfo.aspectRatio,
            duration: videoInfo.duration,
            category: category,
            isShort: videoInfo.isShort
        });
        
        if (result.success) {
            // Recharger les sections
            if (videoInfo.isShort) {
                loadShorts();
            } else {
                loadHomeVideos();
            }
            
            // Mettre à jour le dropdown du profil
            updateProfileDropdown();
            
            // Jouer la nouvelle vidéo
            await playVideo(result.video.id);
            
            alert("Vidéo publiée avec succès !");
        } else {
            alert(`Erreur: ${result.error}`);
        }
    } else {
        // MODIFICATION DE VIDÉO EXISTANTE
        // Pour l'instant, seul le titre, la description et la catégorie peuvent être modifiés
        // L'upload d'une nouvelle vidéo nécessiterait plus de logique
        const updates = {
            title: title,
            description: description,
            category: category
        };
        
        const result = await app.updateVideo(videoToEdit, updates);
        
        if (result.success) {
            // Recharger les sections concernées
            loadHomeVideos();
            loadLibraryContent();
            
            // Si la vidéo modifiée est celle en cours de lecture
            if (app.currentVideoId === videoToEdit) {
                const video = await app.getVideoById(videoToEdit);
                videoTitle.textContent = video.title;
            }
            
            alert("Vidéo mise à jour avec succès !");
        } else {
            alert(`Erreur: ${result.error}`);
        }
    }
    
    closeUploadModal();
});

// Formulaire de profil
profileForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!app.currentUser) return;
    
    const username = profileNameInput.value.trim();
    let avatarUrl = app.currentUser.avatar;
    
    // Traiter l'avatar personnalisé si fourni
    if (customAvatarFile) {
        // Dans une vraie application, il faudrait uploader l'image
        // Pour l'instant, on utilise une URL par défaut
        avatarUrl = `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}&backgroundColor=3ea6ff`;
    } else if (selectedAvatarOption) {
        // Utiliser l'avatar par défaut sélectionné
        avatarUrl = selectedAvatarOption.url;
    }
    
    if (!username) {
        alert("Veuillez entrer un nom d'utilisateur");
        return;
    }
    
    // Mettre à jour le profil
    const result = await app.updateProfile({
        username: username,
        avatar_url: avatarUrl
    });
    
    if (result.success) {
        // Mettre à jour l'utilisateur local
        app.currentUser.username = username;
        app.currentUser.avatar = avatarUrl;
        app.saveToStorage(STORAGE_KEYS.USER_PROFILE, app.currentUser);
        
        // Mettre à jour l'interface
        updateUserInterface();
        
        // Recharger les sections si nécessaire
        if (app.currentSection === 'home') {
            loadHomeVideos();
        }
        if (app.currentSection === 'profile') {
            loadProfile();
        }
        if (app.currentSection === 'library' && app.libraryTab === 'my-videos') {
            loadLibraryContent();
        }
        
        alert("Profil mis à jour avec succès !");
        closeProfileModal();
    } else {
        alert(`Erreur: ${result.error}`);
    }
});

closeProfileModalBtn.addEventListener('click', closeProfileModal);
cancelProfileBtn.addEventListener('click', closeProfileModal);

// Modal de signalement
closeReportModalBtn.addEventListener('click', closeReportModal);
cancelReportBtn.addEventListener('click', closeReportModal);

submitReportBtn.addEventListener('click', () => {
    if (!videoToReport) return;
    
    const selectedReason = document.querySelector('input[name="report-reason"]:checked');
    if (!selectedReason) {
        alert("Veuillez sélectionner une raison pour le signalement.");
        return;
    }
    
    const reason = selectedReason.value;
    const details = reportDetails.value.trim();
    
    // Dans une vraie application, il faudrait envoyer le signalement à la base de données
    // Pour l'instant, on simule avec une alerte
    alert(`Signalement envoyé pour la vidéo ID ${videoToReport}.\nRaison: ${reason}\nDétails: ${details || 'Aucun'}`);
    
    closeReportModal();
});

// Gestion de la miniature dans le modal d'édition
document.getElementById('save-thumbnail').addEventListener('click', async () => {
    if (!videoToEdit) return;
    
    // Vérifier que l'utilisateur est propriétaire
    const video = await app.getVideoById(videoToEdit);
    if (!app.currentUser || video.channelId !== app.currentUser.id) {
        alert("Vous ne pouvez modifier que vos propres vidéos.");
        closeThumbnailModal();
        return;
    }
    
    const newThumbnailFile = document.getElementById('new-thumbnail').files[0];
    let thumbnailUrl = video.thumbnail;
    
    if (newThumbnailFile) {
        // Dans une vraie application, il faudrait uploader la nouvelle miniature
        // Pour l'instant, on utilise une URL par défaut
        thumbnailUrl = `https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80`;
    } else if (selectedThumbnailOption) {
        // Utiliser une miniature par défaut sélectionnée
        thumbnailUrl = selectedThumbnailOption.url;
    }
    
    if (thumbnailUrl !== video.thumbnail) {
        // Mettre à jour la miniature de la vidéo
        const result = await app.updateVideo(videoToEdit, { thumbnail_url: thumbnailUrl });
        
        if (result.success) {
            // Recharger les sections concernées
            if (video.isShort) {
                loadShorts();
            } else {
                loadHomeVideos();
            }
            
            loadLibraryContent();
            
            // Si la vidéo modifiée est celle en cours de lecture
            if (app.currentVideoId === videoToEdit) {
                mainVideo.poster = thumbnailUrl;
            }
            
            alert("Miniature mise à jour avec succès !");
        } else {
            alert(`Erreur: ${result.error}`);
        }
    } else {
        alert("Veuillez sélectionner une nouvelle miniature");
        return;
    }
    
    closeThumbnailModal();
});

document.getElementById('cancel-thumbnail').addEventListener('click', closeThumbnailModal);
document.getElementById('close-thumbnail-modal').addEventListener('click', closeThumbnailModal);

// Effacer l'historique
document.getElementById('clear-history').addEventListener('click', () => {
    if (confirm("Voulez-vous vraiment effacer tout votre historique ?")) {
        app.clearHistory();
        loadHistory();
    }
});

// Fermer les modals en cliquant à l'extérieur
[uploadModal, profileModal, thumbnailModal, reportModal, authModal].forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
            if (modal === uploadModal) {
                uploadForm.reset();
                fileNameDisplay.textContent = '';
                videoToEdit = null;
                customThumbnailFile = null;
                currentVideoFile = null;
            } else if (modal === profileModal) {
                profileForm.reset();
                selectedAvatarOption = null;
                customAvatarFile = null;
            } else if (modal === thumbnailModal) {
                videoToEdit = null;
                selectedThumbnailOption = null;
                document.getElementById('new-thumbnail').value = '';
            } else if (modal === reportModal) {
                videoToReport = null;
                document.querySelectorAll('input[name="report-reason"]').forEach(radio => {
                    radio.checked = false;
                });
                reportDetails.value = '';
            } else if (modal === authModal) {
                loginForm.reset();
                signupForm.reset();
            }
        }
    });
});
}

// Effectuer une recherche
async function performSearch() {
const query = searchInput.value.trim();
if (!query) return;

await showSearchResults(query);
}

// Initialiser l'application
document.addEventListener('DOMContentLoaded', init);

// Gestion du hash URL pour les vidéos
window.addEventListener('hashchange', async () => {
const hash = window.location.hash;
if (hash.startsWith('#video=')) {
    const videoId = hash.split('=')[1];
    await playVideo(videoId);
}
});

// Vérifier l'hash au chargement
window.addEventListener('load', async () => {
const hash = window.location.hash;
if (hash.startsWith('#video=')) {
    const videoId = hash.split('=')[1];
    await playVideo(videoId);
}
});
                    
